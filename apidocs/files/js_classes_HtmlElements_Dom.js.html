<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js\classes\HtmlElements\Dom.js - Newsletter API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..\logo.png" title="Newsletter API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Attributes.html">Attributes</a></li>
            
                <li><a href="../classes/Cell.html">Cell</a></li>
            
                <li><a href="../classes/CKHelper.html">CKHelper</a></li>
            
                <li><a href="../classes/Content.html">Content</a></li>
            
                <li><a href="../classes/Dom.html">Dom</a></li>
            
                <li><a href="../classes/Factory.html">Factory</a></li>
            
                <li><a href="../classes/Helper.html">Helper</a></li>
            
                <li><a href="../classes/Image.html">Image</a></li>
            
                <li><a href="../classes/ImageStyle.html">ImageStyle</a></li>
            
                <li><a href="../classes/Link.html">Link</a></li>
            
                <li><a href="../classes/LinkAttributes.html">LinkAttributes</a></li>
            
                <li><a href="../classes/LinkStyles.html">LinkStyles</a></li>
            
                <li><a href="../classes/List.html">List</a></li>
            
                <li><a href="../classes/ListItem.html">ListItem</a></li>
            
                <li><a href="../classes/ListItemStyles.html">ListItemStyles</a></li>
            
                <li><a href="../classes/ListStyles.html">ListStyles</a></li>
            
                <li><a href="../classes/Mapping.html">Mapping</a></li>
            
                <li><a href="../classes/OList.html">OList</a></li>
            
                <li><a href="../classes/PlainText.html">PlainText</a></li>
            
                <li><a href="../classes/Properties.html">Properties</a></li>
            
                <li><a href="../classes/Row.html">Row</a></li>
            
                <li><a href="../classes/Selection.html">Selection</a></li>
            
                <li><a href="../classes/StringHelper.html">StringHelper</a></li>
            
                <li><a href="../classes/Styles.html">Styles</a></li>
            
                <li><a href="../classes/Table.html">Table</a></li>
            
                <li><a href="../classes/TableAttributes.html">TableAttributes</a></li>
            
                <li><a href="../classes/TableCellStyles.html">TableCellStyles</a></li>
            
                <li><a href="../classes/TableRowStyles.html">TableRowStyles</a></li>
            
                <li><a href="../classes/TableStyles.html">TableStyles</a></li>
            
                <li><a href="../classes/Tag.html">Tag</a></li>
            
                <li><a href="../classes/UList.html">UList</a></li>
            
                <li><a href="../classes/Unit.html">Unit</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/CKHelper.html">CKHelper</a></li>
            
                <li><a href="../modules/Helper.html">Helper</a></li>
            
                <li><a href="../modules/HtmlElements.html">HtmlElements</a></li>
            
                <li><a href="../modules/Properties.html">Properties</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js\classes\HtmlElements\Dom.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*jslint white: false */
/*jslint plusplus: true, white: true */
/*global Node, Dom, Styles, Tag */

/**
 * This class is sort of helper to deal with DOM elements.
 * @module 	    HtmlElements
 * @class  		Dom
 * @constructor
 * @since       0.0.4
 * @author      A.Shcherbakov
 */

function Dom(){
	/**
	 * Returns value of style property &#x60;prop&#x60; of node &#x60;n&#x60;. It looks up the chain of parents until finds
	 * first occurence of key &#x60;prop&#x60;. If the key is not present in any of ancestors, nothing is returned.
	 * @method          _lookUpInParents
	 * @param          {DOM.Node}           n         [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node) instance
	 * @param          {String}             prop      name of the property to look for
	 * @return         {String|void}
	 * @private
	 * @deprecated     in favour of {{#crossLink &quot;Dom/getInheritedStyleProp:method&quot;}}getInheritedStyleProp{{/crossLink}}
	 * @since          0.0.4
	 */
	var _lookUpInParents = function(n, prop){
	    console.log(&#x27;inside _lookUpInParents&#x27;);
	    var currentNode = n,
	        stl;
	    while (currentNode){
	        console.log(&#x27;current Node: &#x27;, currentNode);
	        if (typeof currentNode.getAttribute === &#x27;function&#x27;){
	            stl = new Styles(currentNode.getAttribute(&#x27;style&#x27;));
	            if (stl.hasProperty(prop)){
	                return stl.getProperty(prop);
	            }
	        }
	        currentNode = currentNode.parentNode;
	    }
	};

	/**
	 * Toggles inline style property &#x60;prop&#x60; of node &#x60;n&#x60;. When it turns out that the property should
	 * be set, it is set to value &#x60;val&#x60;.
	 *
	 * @method          _toggleNodeStyle
	 * @private
	 * @param          {DOM.Node}           n          instance of [DOM.Node](https://developer.mozilla.org/en-US/docs/Web/API/Node)
	 * @param          {String}             prop       style property name to be toggled
	 * @param          {String}             val        on-value of the the style property
	 * @param          {String|Null}        altVal     off-value of the style property
	 * @return         {void}
	 * @since          0.0.4
	 */
	var _toggleNodeStyle = function(n, prop, val, altVal){
	    var attrName = &#x27;style&#x27;,
	        stl, stlStr;
	    if (!(typeof n === &#x27;object&#x27; &amp;&amp; n.nodeType)){
	        return;
	    }
	    console.log(&#x27;from parents: &#x27;, _lookUpInParents(n, prop));
	    stl = new Styles(n.getAttribute(attrName));
	    stl.toggleProperty(prop, val, altVal);
	    stlStr = stl.toBareString();
	    if (stlStr){
	        n.setAttribute(attrName, stlStr);
	    } else {
	        n.removeAttribute(attrName);
	    }
	};


	/**
	 * Returns **proxy** node of &#x60;n&#x60;:
	 * &lt;ol&gt;&lt;li&gt;
	 * if &#x60;n&#x60; is a text element without siblings, then proxy of &#x60;n&#x60; is its parent node,
	 * &lt;/li&gt;&lt;li&gt;
	 * if &#x60;n&#x60; is a text element with siblings or is a node element, then proxy of &#x60;n&#x60; is &#x60;n&#x60; itself.
	 * &lt;/li&gt;&lt;/ol&gt;
	 * @method         _proxy
	 * @param          {DOM.Node}          n          [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node) instance
	 * @return         {DOM.Node|Null}
	 */
	this.proxy = function(n){
	    if (n === undefined || n.nodeType === undefined){
	        return null;
	    }
	    if (n.nodeType === Node.ELEMENT_NODE){
	        return n;
	    }
	    return (n.nextSibling || n.previousSibling) ? n : n.parentNode;
	};

	/**
	 * Looks for a value of style property &#x60;key&#x60; of nearest ascendant of &#x60;node&#x60; in the scope of node &#x60;scope&#x60;.
	 * If the property is found, its value is returned, otherwise,  &#x60;undefined&#x60; is returned.
	 *
	 * Limit node &#x60;scope&#x60; is supposed to contain &#x60;node&#x60;. Otherwise, the search for the property
	 * is performed up to the &quot;highest&quot; parent of &#x60;node&#x60;.
	 *
	 * NB: ** optimize algorithm in such a way that DOM is parsed only once even when &#x60;scope&#x60; is set wrong. **
	 * @method         getInheritedStyleProp
	 * @param          {DOM.Node}           node      [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node) instance
	 * @param          {DOM.Node}           scope     [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node) instance
	 * @param          {String}             key       name of property to find among inline style of ascendants
	 * @return         {String|Number|Null}
	 * @since          0.0.4
	 */
	this.getInheritedStyleProp = function(key, node, scope){
		if (node === undefined){
			throw new Error(&quot;Starting node must be defined!&quot;);
		}
		var root, parent, stl,
			currentNode = node;
		root = scope;
		// if the scope is not defined or if it is erraneous, impose scope to be the root.
		if (root === undefined || !root.contains(node)){
			root = node;
			parent = root.parentNode;
			while (parent){
				root = parent;
				parent = root.parentNode;
			}
		}
		while (root.contains(currentNode)){
			// a node might have no &quot;getAttribute&quot; method (as text node does)
			if (typeof currentNode.getAttribute === &#x27;function&#x27;){
				stl = new Styles(currentNode.getAttribute(&#x27;style&#x27;));
				if (stl.hasProperty(key)){
					return stl.getProperty(key);
				}
			}
			currentNode = currentNode.parentNode;
		}
	};


	/**
	 * Modifies inline style properties of a {{#crossLink &quot;Selection/_proxy:method&quot;}}proxy{{/crossLink}}
	 * node of deepest children of node &#x60;n&#x60; in the following way:
	 * &lt;ol&gt;&lt;li&gt;
	 * if style property &#x60;prop&#x60; of the deepest child is equal to &#x60;val&#x60;, then inline
	 * style property of its &quot;proxy&quot; node is set to be &#x60;altVal&#x60;.
	 * &lt;/li&gt;&lt;li&gt;
	 * if style property &#x60;prop&#x60; of the deepest child is not equal to &#x60;val&#x60;, then inline
	 * style property of its &quot;proxy&quot; node is set to be &#x60;val&#x60;.
	 * &lt;/li&gt;&lt;/ol&gt;
	 * @private
	 * @method         _deferToggleStyle
	 * @param          {Node}               n                  [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node) instance
	 * @param          {String}             prop               name of style property (i.e., &quot;width&quot; or &quot;text-decoration&quot;)
	 * @param          {String}             val                value of style property (i.e., &quot;10px&quot; or &quot;underline&quot;)
	 * @return         {void}
	 * @since          0.0.4
	 * @todo           Try to make this method shorter
	 */
	var _deferToggleStyle = function(n, prop, val, altVal){
	    var childNodes = n.childNodes,
	        childNum = childNodes.length,
	        child, span, parent, counter;
	    switch (childNum){
	         // node has no children
	        case 0:
	            if (n.nodeType === Node.ELEMENT_NODE){
	                _toggleNodeStyle(n, prop, val, altVal);
	                break;
	            }
	            if (n.nodeType === Node.TEXT_NODE){
	                console.log(&#x27;from parents: &#x27;, _lookUpInParents(n, prop));
	                span = new Tag();
	                span.setTag(&#x27;span&#x27;);
	                span.setStyleProperty(prop, val);
	                span.setContent(n.nodeValue);
	                parent = n.parentNode;
	                if (parent){
	                    parent.replaceChild(span.toNode(), n);
	                }
	                break;
	            }
	            break;
	        // node has only one child
	        case 1:
	            child = n.firstChild;
	            if (child.nodeType === Node.TEXT_NODE){
	                 _toggleNodeStyle(n, prop, val, altVal);
	            } else {
	                _deferToggleStyle(child, prop, val, altVal);
	            }
	            break;
	        // node has many children
	        default:
	            console.log(&quot;children no. : &quot;, childNum, childNodes);
	            for (counter = 0; counter &lt; childNum; counter++){
	                _deferToggleStyle(childNodes[counter], prop, val, altVal);
	            }
	    }
	};




	/**
	 * Gives common ancestor of nodes n1 and n2. If it does not exist, &#x60;null&#x60; is returned.
	 * @method         _commonAncestor
	 * @private
	 * @param          {DOM.Node}           n1     [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node) instance
	 * @param          {DOM.Node}           n2     [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node) instance
	 * @return         {DOM.Node|Null}
	 * @since          0.0.4
	 */
	var _commonAncestor = function(n1, n2){
	    // console.log(n1, n2);
	    if (n1 === undefined || n2 === undefined){
	        // console.log(&#x27;return undefined&#x27;);
	        return;
	    }
	    if (n1.contains(n2)){
	        // console.log(&#x27;return first argument&#x27;, n1);
	        return n1;
	    }
	    if (n2.contains(n1)){
	        // console.log(&#x27;return second argument&#x27;, n2);
	        return n2;
	    }
	    var parent = n1.parentNode;
	    while (parent &amp;&amp; !(parent.contains(n2))){
	        // console.log(&#x27;inside while loop: &#x27;, parent);
	        parent = parent.parentNode;
	    }
	    // console.log(&#x27;return parent&#x27;, parent);
	    return parent;
	};

	/**
	 * Gives common ancestor of nodes n1 and n2. If it does not exist, &#x60;null&#x60; is returned.
	 * @method         commonAncestor
	 * @param          {DOM.Node}           n1     [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node) instance
	 * @param          {DOM.Node}           n2     [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node) instance
	 * @return         {DOM.Node|Null}
	 */
	this.commonAncestor = function(n1, n2){
	    return _commonAncestor(n1, n2);
	};

	/**
	 * Returns common ancestor of all array elements. If an element is not a
	 * [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node) instance, it is ignored.
	 * @method         commonAncestorSoft
	 * @return         {DOM.Node|Null}      common ancestor of the arguments
	 */
	this.commonAncestorSoft = function(elems){
	    if (!Array.isArray(elems)){
	        return null;
	    }
	    var arg = elems.filter(function(el){
	        return el &amp;&amp; el.nodeType !== undefined;
	    });
	    if (arg.length === 0){
	        return null;
	    }
	    var el = arg.shift(),
	        elTmp;
	    while (arg.length &gt; 0){
	        elTmp = arg.shift();
	        el = _commonAncestor(el, elTmp);
	    }
	    return el;
	};

	/**
	 * Normalize parent of elements of the array.
	 * @method  normalizeParentOf
	 * @param  {Array}     elems
	 * @return {void}
	 */
	this.normalizeParentOf = function(elems){
	    var el = this.commonAncestorSoft(elems);
	    if (el){
	        el.normalize();
	    }
	};


	/**
	 * Toggles style property &#x60;key&#x60; of element &#x60;elem&#x60; from &#x60;primary&#x60; to &#x60;secondary&#x60;.
	 * If the element has style property &#x60;key&#x60; equal to &#x60;primary&#x60;, then it is imposed to &#x60;secondary&#x60;.
	 * Otherwise, it is imposed to &#x60;primary&#x60;.
	 *
	 * An element is considered to have style property imposed if either the element itself, or any of
	 * its parents has that value imposed.
	 *
	 * If not [Element](https://developer.mozilla.org/en-US/docs/Web/API/Element) instance is given as the first
	 * argument, then the method performs nothing. Note, that for text nodes this method is not applicable,
	 * since text nodes have no attributes.
	 * @method         toggleElementStyle
	 * @param          {DOM.Element}        elem       [Element](https://developer.mozilla.org/en-US/docs/Web/API/Element) instance
	 * @param          {String}             key        name of style property to change
	 * @param          {String|Number}      primary    primary value of the above style property
	 * @param          {String|Number}      secondary  secondary value of the style property
	 * @return         {void}
	 * @since          0.0.4
	 */
	this.toggleElementStyle = function(elem, key, primary, secondary){
		if (elem &amp;&amp; elem.nodeType === Node.ELEMENT_NODE){
			var attrName = &#x27;style&#x27;,
				stl = new Styles(elem.getAttribute(attrName)),
				styleValue = this.getInheritedStyleProp(key, elem);
			stl.setProperty(key, (styleValue === primary) ? secondary :  primary);
			elem.setAttribute(attrName, stl.toBareString());
		}
	};

	/**
	 * Returns an [Element](https://developer.mozilla.org/en-US/docs/Web/API/Element) instance with the style
	 * property &#x60;key&#x60; equal to &#x60;secondary&#x60; if value of &#x60;key&#x60; attribute in &quot;style&quot; property  is equal to &#x60;primary&#x60;. Otherwise,
	 * &#x60;key&#x60; value will be imposed to &#x60;primary&#x60;.
	 *
	 * Created instance is a &quot;span&quot; html tag.
	 * @method         createToggledElemFromText
	 * @param          {DOM.Text}           textNode        [Text](https://developer.mozilla.org/en-US/docs/Web/API/Text)
	 *                                                      instance whose &quot;toggle&quot; copy is to be created
	 * @param          {String}             key             name of style property (i.e., text-decoration&quot;, &quot;font-style&quot;)
	 * @param          {String|Number}      primary         primary value of the style property
	 * @param          {String|Number}      secondary       secondary value
	 * @return         {DOM.Node}
	 * @since          0.0.4
	 */
	this.createToggledElemFromText = function(textNode, key, primary, secondary){
		if (textNode &amp;&amp; textNode.nodeType === Node.TEXT_NODE){
			var output = document.createElement(&#x27;span&#x27;),
				textNodeCopy = document.createTextNode(textNode.nodeValue),
				styleValue = this.getInheritedStyleProp(key, textNode),
				styleToggled = styleValue === primary ? secondary : primary;
			output.setAttribute(&#x27;style&#x27;, key + &#x27;: &#x27; + styleToggled + &#x27;;&#x27;);
			output.appendChild(textNodeCopy);
			return output;
		}
	};


	/**
	 * Returns a one-dimensional array of [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node) instances
	 * that are descendants of &#x60;startNode-...-endNode&#x60; path but do not belong to that path.
	 * If path from &#x60;startNode&#x60; to &#x60;endNode&#x60; does not exist, an error is thrown.
	 * &lt;dl&gt;
	 * &lt;dt&gt; Path A - ... - B&lt;/dt&gt;
	 * &lt;dd&gt; An ordered collection of nodes n&lt;sub&gt;i&lt;/sub&gt; from which one needs to pass through in order
	 * to arrive to node B starting from node A passing always from a node to its child.
	 * &lt;/dd&gt;
	 * &lt;dt&gt; Descendant of a path A - ... - B&lt;/dt&gt;
	 * &lt;dd&gt;
	 * 	A node C is a descendant of A - ... - B path if parent of node C belongs to A - ... - B path.
	 * &lt;/dd&gt;
	 * &lt;/dl&gt;
	 * @method         complementNodes
	 * @param          {DOM.Node}           startNode          a [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node)
	 *                                                         instance from which to start the path
	 * @param          {DOM.Node}           endNode            a [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node)
	 *                                                         instance at which to finish the path
	 * @return         {Array}                                 one-dimensional array of
	 *                                                         [Node](https://developer.mozilla.org/en-US/docs/Web/API/Node)
	 *                                                         instances or empty array
	 */
	this.complementNodes = function(startNode, endNode){
		if (!startNode.contains(endNode)){
			throw new Error(&quot;Start node must contain the end one!&quot;);
		}
		if (startNode.isEqualNode(endNode)){
			return [];
		}
		var children = startNode.childNodes,
			len = children.length,
			i, child,
			result = [];
		for (i = 0; i &lt; len; i++){
			child = children[i];
			if (!child.contains(endNode)){
				result.push(child);
			} else {
				result = result.concat(this.complementNodes(child, endNode));
			}
		}
		return result;
	};

}


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
