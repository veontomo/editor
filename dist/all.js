function Cell(t){"use strict";return this instanceof Cell?(Tag.call(this,t),this.setTag("td"),this.setName("Cell"),this.setProperties(new CellProperties),void this.setContent(new Content(t))):new Cell(t)}Cell.prototype=Object.create(Tag.prototype),Cell.prototype.characteristicFunction=function(t){return t instanceof Element&&"td"===t.tagName.toLowerCase()};

function ImageTag(){"use strict";if(!(this instanceof ImageTag))return new ImageTag;Tag.call(this);var t=["http","https"];this.setTag("img"),this.setName("ImageTag"),this.setProperties(new ImageProperties),this.setOrigin=function(e){var r=this.getProtocol(e);if(-1===t.indexOf(r))return void console.log("protocol "+r+" is not supported!");var i,s,o=document.createElement("img");o.src=e,i=o.width,s=o.height,"number"==typeof i&&i>0&&"number"==typeof s&&s>0&&(this.setProperty("src",e),this.setProperty("width",i),this.setWidth(i),this.setStyleProperty("height",s),this.setProperty("height",s))},this.dropProtocol=function(t){var e="://",r="^[^"+e+"]+"+e,i=new RegExp(r,"gi");return t.replace(i,"")},this.getProtocol=function(t){var e="://",r="^[^"+e+"]+"+e,i=new RegExp(r,"gi"),s=t.match(i);return Array.isArray(s)&&"string"==typeof s[0]?s[0].replace(e,""):null},this.getOrigin=function(){return this.getProperty("src")},this.getHeight=function(){return this.getProperty("height")||0},this.toHtml=function(){var t=this.getOrigin();return"string"==typeof t&&t.length>0?this.openingTag()+this.closingTag():""},this.template=function(){var t={name:"img",root:{src:this.getOrigin(),alt:this.getProperty("alt"),title:this.getProperty("title")}};return t},this.loadFromTemplate=function(t){var e;for(e in t)if(t.hasOwnProperty(e))switch(e){case"title":this.setProperty(e,t[e]);break;case"src":this.setOrigin(t[e]);break;case"alt":this.setProperty(e,t[e])}}}ImageTag.prototype=Object.create(Tag.prototype),ImageTag.prototype.characteristicFunction=function(t){return t instanceof Element&&"img"===t.tagName.toLowerCase()};
function Link(t){"use strict";return this instanceof Link?(Tag.call(this),this.setTag("a"),this.setName("Link"),this.setProperties(new LinkProperties),this.getHref=function(){return this.getProperty("href")},this.setHref=function(t){this.setProperty("href",encodeURI(t))},t&&"string"==typeof t&&this.setHref(t),this.underline=function(t){t===!0||void 0===t?this.setStyleProperty("text-decoration","underline"):t===!1?this.setStyleProperty("text-decoration","none"):"string"==typeof t&&this.setStyleProperty("text-decoration",t)},this.dropUnderline=function(){this.setStyleProperty("text-decoration","none")},this.apply=function(t){return t instanceof Link?this.updateLink(t):t instanceof Content?this.applyContent(t):t instanceof Tag?this.applyTag(t):this.wrap(t)},this.wrap=function(t){var e=new Link,n="function"==typeof t.clone?t.clone():t;return e.setProperties(this.getProperties().clone()),e.setStyles(this.getStyles().clone()),e.setElements([n]),e},this.applyTag=function(t){if(t instanceof Tag){var e,n,i;return t.getContent().isEmpty()?e=this.wrap(t):(e=t.clone(),n=e.getContent(),i=this.applyContent(n),e.setContent(i)),e}},this.applyContent=function(t){if(t instanceof Content){var e,n,i,r,s=new Content,o=t.getElements(),p=o.length;for(e=0;p>e;e++)n=o[e],r=this.clone(),i=r.apply(n),s.appendElem(i);return s}},this.updateLink=function(t){if(t instanceof Link){var e=new Link,n=this.getHref();return e.setElements(t.getElements()),e.setProperties(this.getProperties()),e.setStyles(this.getStyles()),e.appendStyle(t.getStyles()),e.appendProperties(t.getProperties()),e.setHref(n),e}},this.isUnderlined=function(){return"underline"===this.getStyleProperty("text-decoration")},this.template=function(){var t={name:"link",root:{href:this.getHref(),color:this.getStyleProperty("color"),isUnderlined:this.isUnderlined(),isTargetBlank:this.shouldOpenNew(),content:this.getContent().toText(),title:this.getProperty("title")}};return t},void(this.shouldOpenNew=function(){return"_blank"===this.getProperty("target")})):new Link(t)}Link.prototype=Object.create(Tag.prototype),Link.parseUri=function(t){if("string"!=typeof t||""===t)return{};var e=t.match(/^((\w+):(\/\/)?)?(.+?)(\/?)$/),n={};return e?(n.protocol=e[2]||"http",e[4]&&(n.href=e[4]),n):n},Link.prototype.characteristicFunction=function(t){return t instanceof Element&&"a"===t.tagName.toLowerCase()};
function List(t){"use strict";if(!(this instanceof List))return new List(t);Tag.call(this);var e=["ol","ul"];this.getAllowedTags=function(){return e.slice(0)},this.setTag(-1!==e.indexOf(t)?t:e[0]),this.setName("List"),this.setProperties(new ListProperties),this.switchName=function(t){-1!==e.indexOf(t)&&this.setTag(t)},this.itemNum=function(){return this.length()},this.appendItem=function(t){if(!(t instanceof ListItem))throw new Error("The argument is not a ListItem instance!");this.appendElem(t)},this.insertItemAt=function(t,e){if(!(e instanceof ListItem))throw new Error("The item to insert is not a ListItem instance!");this.insertElemAt(t,e)},this.appendList=function(t){var e,i;if(!(t instanceof List))throw new Error("The argument must be a List instance!");for(e=t.length(),i=0;e>i;i++)this.appendItem(t.getElem(i))},this.appendAsItems=function(t){if(void 0!==t){var e=Array.isArray(t)?t:[t],i=this.getElements();e.forEach(function(t){var e=new ListItem;e.appendElem(t),i.push(e)}),this.setElements(i)}}}List.prototype=Object.create(Tag.prototype),List.prototype.characteristicFunction=function(t){if(!(t instanceof Element))return!1;var e=t.tagName.toLowerCase();return"ul"===e||"ol"===e};
function ListItem(){"use strict";return this instanceof ListItem?(Tag.call(this),this.setTag("li"),this.setName("ListItem"),void this.setProperties(new ListItemProperties)):new ListItem}ListItem.prototype=Object.create(Tag.prototype),ListItem.prototype.characteristicFunction=function(t){return t instanceof Element&&"li"===t.tagName.toLowerCase()};
function OList(){"use strict";return this instanceof OList?(List.call(this),this.setTag("ol"),void this.setName("OList")):new OList}OList.prototype=Object.create(List.prototype),OList.prototype.characteristicFunction=function(t){return t instanceof Element&&"ol"===t.tagName.toLowerCase()};
function PlainText(t){"use strict";if(!(this instanceof PlainText))return new PlainText(t);var n="PlainText",e="text";this.getTag=function(){return e},this.getName=function(){return n};var i="string"==typeof t||"number"==typeof t?t.toString():"";this.setContent=function(t){var n=typeof t;i="string"===n||"number"===n?t.toString():""},this.getContent=function(){return i.toString()},this.toHtml=function(){return this.getContent().toString()},this.loadFromElement=function(t){if(void 0===t||null===t)return!1;var n="string"==typeof t?t:t.textContent,e="string"==typeof n;return e&&this.setContent(n),e},this.isEmpty=function(){var t=this.getContent();return null===t||void 0===t||""===t},this.toNode=function(){return document.createTextNode(this.getContent())},this.clone=function(){var t,n,e,i=window[this.className],o=this.getContent();t="function"==typeof i?new i:new PlainText;for(n in this)this.hasOwnProperty(n)&&(e=this[n],t[n]=e&&"function"==typeof e.clone?e.clone():e);return t.setContent(o),t},this.toText=function(){return this.toHtml()}}
function Row(){"use strict";return this instanceof Row?(Tag.call(this),this.setTag("tr"),this.setName("Row"),this.setProperties(new RowProperties),this.getCellWidths=function(){var t,e=[],i=this.cellNum();for(t=0;i>t;t++)e.push(this.getElem(t).getWidthValue());return e},this.cellNum=function(){return this.length()},this.setCellWidths=function(t){var e,i=t.length;if(this.cellNum()!==i)throw new Error("Incompatible array length!");for(e=0;i>e;e++)this.getElem(e).setWidth(t[e])},this.insertCellAt=function(t,e){if(!(e instanceof Cell))throw new Error("Only a Cell instance is allowed for insertion!");this.insertElemAt(t,e)},this.appendCell=function(t){if(!(t instanceof Cell))throw new Error("The argument is not a Cell instance!");this.appendElem(t)},this.onlyTableInside=function(){var t=this.getFirst();return void 0===t||1!==this.cellNum()||1!==t.length()?!1:t.getFirst()instanceof Table},this.dropCellAt=function(t){this.dropElemAt(t)},this.knockOutCell=function(t){var e,i,n,s,r,l,o;t<this.cellNum()&&(this.getElem(t+1)?e=this.getElem(t+1):this.getElem(t-1)&&(e=this.getElem(t-1)),e&&(i=e.getWidth(),n=this.getElem(t),s=n.getWidth(),l=new Unit(i),o=new Unit(s),r=l.add(o),e.setWidth(r.getValue())),this.dropElemAt(t))},this.appendStyleToCellAt=function(t,e){this.appendStyleToElemAt(t,e)},this.phantomCellStyles=function(){return this.getPhantomCellProp("style")},this.phantomCellAttr=function(){return this.getPhantomCellProp("attr")},this.getPhantomCellProp=function(t){if(this.onlyTableInside()){if("style"===t)return this.getFirst().getStyles();if("attr"===t)return this.getFirst().getProperties()}},this.getPhantomTableProp=function(t){if(this.onlyTableInside()){if("style"===t)return this.getFirst().getFirst().getStyles();if("attr"===t)return this.getFirst().getFirst().getProperties()}},this.phantomTableStyles=function(){return this.getPhantomTableProp("style")},this.phantomTableAttr=function(){return this.getPhantomTableProp("attr")},this.makeShape=function(t,e){if(void 0===t)throw new Error("Number of cells is missing.");if(parseInt(t,10)!==t||0>=t)throw new Error("Number of cells must be positive integer.");var i="function"==typeof e;this.flushContent();var n,s;for(n=0;t>n;n++)s=new Cell,i&&s.setContent(e(n)),this.appendCell(s)},void(this.setCellTopBorder=function(t){var e,i,n=new Content,s=this.cellNum();for(e=0;s>e;e++)i=this.getElem(e),i.setStyleProperty("border-top",t),n.appendElem(i);this.setContent(n)})):new Row}Row.prototype=Object.create(Tag.prototype),Row.prototype.characteristicFunction=function(t){return t instanceof Element&&"tr"===t.tagName.toLowerCase()};
function Table(){"use strict";if(!(this instanceof Table))return new Table;Tag.call(this),this.setTag("table"),this.setName("Table"),this.setProperties(new TableProperties);var t,e,r;this.initPhantoms=function(){e instanceof Row||(e=new Row),t instanceof Cell||(t=new Cell),r instanceof Table||(r=new Table)},this.getPhantomCellStyles=function(){return t instanceof Cell?t.getStyles():void 0},this.setPhantomCellStyles=function(e){void 0!==e&&(this.initPhantoms(),t.setStyles(e instanceof Properties?e:new Properties(e)))},this.getPhantomRowStyles=function(){return e instanceof Row?e.getStyles():void 0},this.setPhantomRowStyles=function(t){void 0!==t&&(this.initPhantoms(),e.setStyles(t instanceof Properties?t:new Properties(t)))},this.getPhantomTableStyles=function(){return r instanceof Table?r.getStyles():void 0},this.setPhantomTableStyles=function(t){void 0!==t&&(this.initPhantoms(),r.setStyles(t instanceof Properties?t:new Properties(t)))},this.getPhantomCellAttributes=function(){return t instanceof Cell?t.getProperties():void 0},this.setPhantomCellAttributes=function(e){this.initPhantoms(),t.setProperties(e)},this.getPhantomRowAttributes=function(){return e instanceof Row?e.getProperties():void 0},this.setPhantomRowProperties=function(t){this.initPhantoms(),e.setProperties(t)},this.setPhantomCellProperties=function(e){this.initPhantoms(),t.setProperties(e)},this.getPhantomTableAttributes=function(){return r instanceof Table?r.getProperties():void 0},this.setPhantomTableProperties=function(t){this.initPhantoms(),r.setProperties(t)},this.getPhantomTableProperties=function(){return this.initPhantoms(),r.getProperties()},this.getPhantomCellProperties=function(){return t.getProperties()},this.getPhantomRowProperties=function(){return e.getProperties()},this.getPhantomTag=function(o,i){if("string"==typeof o){var n=o.toLowerCase(),s="string"==typeof i&&"close"===i.toLowerCase()?"closingTag":"openingTag";if("cell"===n&&void 0!==t&&"function"==typeof t[s])return t[s]();if("row"===n&&void 0!==e&&"function"==typeof e[s])return e[s]();if("table"===n&&void 0!==r&&"function"==typeof r[s])return r[s]()}},this.rowNum=function(){var t=this.getBody();return t?t.length:0},this.setBody=function(t){var e,r=Array.isArray(t)?t:[t];if(e=r.every(function(t){return t instanceof Row}),!e)throw new Error("Instance of Row class is required to be set as tbody!");var o=this.getContent(),i=o.findTagPos("tbody"),n=new Tag("tbody");n.setElements(r),i.length>0&&(i.sort(function(t,e){return e-t}),i.forEach(function(t){o.dropElemAt(t)})),o.appendElem(n),this.setContent(o)},this.setElements=function(t){this.setBody(t)},this.getBody=function(){var t=this.getContent(),e=t.getFirstEntryOfTag("tbody");return e?e.getElements():[]},this.getFooter=function(){var t=this.getContent();return t?t.getFirstEntryOfTag("tfoot"):void 0},this.getHeader=function(){var t=this.getContent();return t?t.getFirstEntryOfTag("thead"):void 0},this.getCaption=function(){var t=this.getContent();return t?t.getFirstEntryOfTag("caption"):void 0},this.appendRow=function(t){if(!(t instanceof Row))throw new Error("The argument is not a Row instance!");var e=this.getContent(),r=e.getFirstEntryOfTag("tbody");r?r.appendElem(t):(r=new Tag("tbody"),r.setElements([t]),e.appendElem(r)),this.setContent(e)},this.getMatrix=function(){var t,e=[],r=this.rowNum(),o=this.getBody();for(t=0;r>t;t++)e.push(o[t].getCellWidths());return e},this.getProfile=function(){var t=this.isSameWidths()?this.getMatrix()[0]:null;return t},this.setProfile=function(t){var e,r=this.rowNum(),o=this.colNum();if(!Array.isArray(t))throw new Error("Wrong argument type: array expected.");if(t.length!==o)throw new Error("Wrong input array length!");var i=this.getBody();for(e=0;r>e;e++)i[e].setCellWidths(t);this.setBody(i)},this.insertColAt=function(t,e){e=e||new Cell;var r,o=this.colNum(),i=this.rowNum(),n=this.getBody();if(0>=o||0>t||t>o)throw new Error("Wrong index for the cell to insert!");if(o>t)for(r=0;i>r;r++)n[r].insertCellAt(t,e);else for(r=0;i>r;r++)n[r].appendCell(e);return this.setBody(n),null},this.knockOutCol=function(t){var e,r=this.rowNum(),o=this.getBody();for(e=0;r>e;e++)o[e].knockOutCell(t);this.setBody(o)},this.dropColAt=function(t){var e,r=this.rowNum(),o=this.getBody();for(e=0;r>e;e++)o[e].dropCellAt(t);this.setBody(o)},this.colNum=function(){var t,e,r,o=this.rowNum();if(0===o)return 0;if(r=this.getBody(),t=r[0].cellNum(),1===o)return t;for(e=1;o>e;e++)if(r[e].cellNum()!==t)return null;return t},this.isSameWidths=function(){var t,e,r,o,i=this.getMatrix(),n=i.length,s=!0;if(n>1)for(t=i[0],e=t.length,r=1;n>r;r++){if(i[r].length!==e){s=!1;break}for(o=0;e>o;o++)if(i[r][o]!==t[o]){s=!1;break}if(!s)break}return s},this.setBorder=function(t){var e=this.getProperties();e.setBorder(t),this.setProperties(e)},this.getBorder=function(){return this.getProperties().getBorder()},this.removeBorder=function(){var t=this.getProperties();t.removeBorder(),this.setProperties(t)},this.isFragmented=function(){return 0===this.rowNum()?!1:this.getBody().every(function(t){var e=t.onlyTableInside();return e})},this.isFramed=function(){return void 0!==e||void 0!==t||void 0!==r},this.unsetPhantom=function(){e=void 0,t=void 0,r=void 0},this.appendStyleToCol=function(t,e){var r,o=parseInt(t,10),i=this.colNum(),n=this.rowNum(),s=this.getBody();if(!(o===t&&t>=0&&i>t))throw new Error("The column is not present!");for(r=0;n>r;r++)s[r].appendStyleToCellAt(t,e);this.setBody(s)},this.bodyToHtml=function(){var t="",e="",r="";return this.isFramed()&&(e=this.getPhantomTag("row","open")+this.getPhantomTag("cell","open")+this.getPhantomTag("table","open"),t=this.getPhantomTag("table","close")+this.getPhantomTag("cell","close")+this.getPhantomTag("row","close")),this.getBody().forEach(function(o){"function"==typeof o.toHtml&&(r+=e+o.toHtml()+t)}),r},this.toHtml=function(){var t=this.openingTag(),e=this;return this.getElements().forEach(function(r){"function"==typeof r.toHtml&&(t+="tbody"===r.getTag()?r.openingTag()+e.bodyToHtml()+r.closingTag():r.toHtml())}),t+=this.closingTag()},this.toNode=function(){var o=document.createElement(this.getTag());if(this.getProperties().decorateElement(o),this.isFramed()){var i=this.getBody();i.forEach(function(i){var n=i.toNode(),s=e.toNode(),l=t.toNode(),a=r.toNode();s.appendChild(l),l.appendChild(a),a.appendChild(n),o.appendChild(s)})}else this.getContent().stickTo(o);return o},this.getPhantomRowProp=function(t){if(!this.isFragmented())return null;var e,r,o,i=this.getFirst(),n=this.rowNum();switch(t){case"attr":o=i.getProperties();break;case"style":o=i.getStyles();break;default:return null}if(1===n)return o;if("function"!=typeof o.isTheSameAs)return null;for(r=1;n>r;r++)if(e="style"===t?this.getElem(r).getStyles():"attr"===t?this.getElem(r).getProperties():null,!o.isTheSameAs(e))return null;return o},this.getRow=function(t){if(void 0!==t){var e=this.rowNum();if(e>0&&t>=0&&e>t)return this.getBody()[t]}},this.getFirstRow=function(){return this.rowNum()>0?this.getBody()[0]:void 0},this.getLastRow=function(){var t=this.rowNum();return t>0?this.getBody()[t-1]:void 0},this.getPhantomCellProp=function(t){if(!this.isFragmented())return null;var e,r,o,i=this.rowNum(),n=this.getFirst();if(e=n.getPhantomCellProp(t),1===i)return e;for(r=1;i>r;r++)if(o=this.getElem(r).getPhantomCellProp(t),!e.isTheSameAs(o))return null;return e},this.getPhantomTableProp=function(t){if(!this.isFragmented())return null;var e,r,o,i=this.rowNum(),n=this.getFirst();if(e=n.getPhantomTableProp(t),1===i)return e;for(r=1;i>r;r++)if(o=this.getElem(r).getPhantomTableProp(t),!e.isTheSameAs(o))return null;return e},this.disentangle=function(){if(!this.isFragmented())return null;var t,e,r,o,i,n=[],s=this.rowNum();if(i=this.getBody(),e=this.getFirstRow(),e&&(this.setPhantomRowProperties(e.getProperties()),r=e.getFirst(),r&&(this.setPhantomCellProperties(r.getProperties()),o=r.getFirst()))){for(this.setPhantomTableProperties(o.getProperties()),t=0;s>t;t++)try{n.push(i[t].getFirst().getFirst().getFirstRow())}catch(l){console.log("Error ("+l.name+") when retrieving nested rows "+l.message)}try{this.setBody(n)}catch(l){console.log("Error ("+l.name+") when setting table body "+l.message)}}},this.makeShape=function(t,e,r){if(void 0===t)throw new Error("Number of rows and columns are missing.");if(parseInt(t,10)!==t||0>=t)throw new Error("Number of rows must be positive integer.");var o,i,n,s="function"==typeof r;for(this.flushContent(),o=0;t>o;o++)i=new Row,s?(n=function(t){return r(o,t)},i.makeShape(e,n)):i.makeShape(e),this.appendRow(i)},this.markRows=function(t){var e,r,o=this.rowNum(),i=new Content;for(e=0;o>e;e++)r=this.getElem(e),r&&"function"==typeof r.mark&&(r.mark(t),i.appendElem(r));this.setContent(i)},this.configureProperties=function(t){console.log("configuring properties: ",t);var e,r,o=t.width,i=t.tableBorderWidth,n=t["border-spacing"],s=o.clone(),l=n.frac(2,0);t.margin.getValue()>0&&(this.setStyleProperty("margin",t.margin.toString()),s=s.sub(t.margin.times(2)));var a=t.padding;if(this.setStyleProperty("padding",a.toString()),this.setProperty("cellspacing",a.getValue()),s=s.sub(a.times(2)),i.getValue()>0&&(s=s.sub(i.times(2)),this.setBorder({style:"solid",color:t.tableBorderColor,width:i.getValue()})),this.setWidth(s.getValue()),this.setStyleProperty("border-spacing","0px "+l.toString()),t.globalTableBgColor&&this.setStyleProperty("background-color",t.globalTableBgColor),t.phantomBorderWidth.getValue()>0){var h=new RowProperties,u=new CellProperties,g=new TableProperties;h.setStyleProperty("padding",0),h.setStyleProperty("margin",0),u.setStyleProperty("padding",0),u.setStyleProperty("margin",0),h.setWidth(s.getValue()),u.setWidth(s.getValue()),g.setBorder({style:"solid",color:t.phantomBorderColor,width:t.phantomBorderWidth.getValue()}),s=s.sub(t.phantomBorderWidth.times(2)),g.setWidth(s.getValue()),this.setPhantomRowProperties(h),this.setPhantomCellProperties(u),this.setPhantomTableProperties(g)}this.setAllRowWidths(s.getValue()),e=Helper.columnWidths2(s.getValue(),t.cellWeights);var f=t.cellBorderWidth.toString()+" solid "+t.cellBorderColor;if(t.cellBorders.topHor&&this.setStylePropertyOfBlock("border-top",f,[0]),t.cellBorders.bottomHor&&t.rows>0&&this.setStylePropertyOfBlock("border-bottom",f,[t.rows-1]),t.cellBorders.intHor){var d=[];for(r=1;r<t.rows;r++)d.push(r);this.setStylePropertyOfBlock("border-top",f,d)}if(t.cellBorders.leftVer&&(this.setStylePropertyOfBlock("border-left",f,null,[0]),e[0]-=t.cellBorderWidth.getValue()),t.cellBorders.rightVer&&(this.setStylePropertyOfBlock("border-right",f,null,[t.cols-1]),e[e.length-1]-=t.cellBorderWidth.getValue()),t.cellBorders.intVer){var c=[];for(r=1;r<t.cols;r++)c.push(r),e[r]-=t.cellBorderWidth.getValue();this.setStylePropertyOfBlock("border-left",f,null,c)}this.setStylePropertyOfBlock("padding",t["cell[padding]"].toString(),null,null),this.setProfile(e)},this.setStylePropertyOfBlock=function(t,e,r,o){if(!Array.isArray(r)&&null!==r&&void 0!==r)throw new Error("Row range must be an array!");var i,n,s=this.getBody(),l=[],a=s.length,h=null===r||void 0===r;for(n=0;a>n;n++)i=s[n],(h||-1!==r.indexOf(n))&&i.setStylePropertyOfRange(t,e,o),l.push(i);this.setBody(l)},this.setAllRowWidths=function(t){if("string"!=typeof t&&"number"!=typeof t)throw new Error("Width must be a string or a number!");var e,r,o=this.getBody(),i=[],n=o.length;for(r=0;n>r;r++)e=o[r],e.setWidth(t),i.push(e);this.setBody(i)},this.getStylePropertyOfBlock=function(t,e,r){if(!Array.isArray(e)&&null!==e&&void 0!==e)throw new Error("Row range must be an array!");var o,i,n,s,l=this.getBody(),a=l.length,h=null===e||void 0===e;for(h||(e=e.map(function(t){return 0>t?a+t:t})),i=0;a>i;i++)if(h||-1!==e.indexOf(i))if(o=l[i],s=o.getStylePropertyOfRange(t,r),void 0===n)n=s;else if(n!==s)return;return n},this.update=function(t){var e=this.clone();return e.configureProperties(t),e},this.getStylePropertyOfRangeAsBorderInfo=function(t,e,r){var o=this.getStylePropertyOfBlock(t,e,r),i={style:"none"};if(o){o=o.trim();var n=new RegExp(/\s+/g),s=o.split(n);if(s.length>=3){var l=s.shift(),a=s.shift();0===parseInt(l,10)?i.style="none":(i.style=a,i.width=l,i.color=s.join(" "))}}return i};var o=function(t,e){var r=0,o=[];for(r=0;e>r;r++)o[r]=t+r;return o};this.getCellBorders=function(){var t,e,r,i,n={},s=o(1,this.rowNum()-1),l=o(1,this.colNum()-1),a={topHor:["border-top",[0]],bottomHor:["border-bottom",[-1]],intHor:["border-top",s],leftVer:["border-left",null,[0]],rightVer:["border-right",null,[-1]],intVer:["border-left",null,l]};for(i in a)a.hasOwnProperty(i)&&(e=a[i],r=this.getStylePropertyOfRangeAsBorderInfo(e[0],e[1],e[2]),n[i]="none"!==r.style,void 0===t&&n[i]&&(t=parseInt(r.width,10),n.width=t,n.color=r.color));return n},this.getPhantomTableBorder=function(){var t={style:"none"},e=this.getPhantomTableProperties();return e&&(t=e.getBorder()),t},this.extractPhantomTemplate=function(t){var e="frame";return t&&t.hasOwnProperty(e)?t[e]:void 0},this.loadTemplate=function(t){var e=this.extractProperTemplate(t),r=this.extractPhantomTemplate(t);e.hasOwnProperty("border-width")&&(e["border-style"]="solid"),this.setProperties(e),this.setWidth(e.width),r&&(r.width=e.width,this.setPhantomTemplate(r));var o,i,n=parseInt(t.rows,10),s=t.row;if("number"==typeof n){for(s.cell=t.cell,console.log(s),o=0;n>o;o++)i=new Row,0===o&&s&&s["border-first"]&&i.setStyleProperty("border-top",s.root.style["border-width"]+"px solid "+s.root.style["border-color"]),o===n-1&&t.row["border-last"]&&console.log("create border of the last row"),o>0&&n-1>o&&t.row["border-middle"]&&console.log("create border of the middle row"),console.log("loading row template:",s),i.loadTemplate(s),this.appendRow(i);console.log("rows: "+t.rows,", columns: "+t.columns)}},this.setPhantomTemplate=function(t){var e=new Properties(t);e.setMode(Properties.MODE_STYLE),this.setPhantomTableProperties(e),this.setPhantomRowProperties(e),this.setPhantomCellProperties(e)}}Table.prototype=Object.create(Tag.prototype),Table.prototype.characteristicFunction=function(t){return t instanceof Element&&"table"===t.tagName.toLowerCase()};
function Tag(t){"use strict";if(!(this instanceof Tag))return new Tag;var e=t||null,n="Tag";this.getTag=function(){return e},this.setTag=function(t){if(void 0!==t){var n=typeof t;"string"===n?e=t:"number"===n&&(e=t.toString())}};var r=new Properties,i=new Content,o=null,s=new Unit;this.setUnitWorker=function(t){t&&(s=t)},this.getUnitWorker=function(){return s},this.getMarker=function(){return o},this.setMarker=function(t){"string"==typeof t&&""!==t&&(o=t)},this.setProperties=function(t){r=t instanceof Properties?t.clone():new Properties(t)},this.getProperties=function(){var t=r.clone();return t},this.setStyles=function(t){r.setStyles(t)},this.getStyles=function(){return r.getStyles()},this.setContent=function(t){i=t instanceof Content?t:new Content(t)},this.getContent=function(){return i.clone()},this.getName=function(){return n},this.setName=function(t){"string"==typeof t&&(n=t)},this.appendStyle=function(t){r.appendStyle(t)},this.appendAttributes=function(t){console.log("This method is deprecated. Redirected to appendProperties()"),r.appendProperties(t)},this.appendProperties=function(t){r.appendProperty(t)},this.appendStyleToElemAt=function(t,e){i.appendStyleToElemAt(t,e)},this.getStyleProperty=function(t){var e=this.getStyles();return e?e.getProperty(t):void 0},this.setStyleProperty=function(t,e){return r.setStyleProperty(t,e)},this.getProperty=function(t){return this.getProperties().getProperty(t)},this.setProperty=function(t,e){r.setProperty(t,e)},this.hasProperty=function(t){var e=this.getProperties();return e&&e.hasProperty(t)},this.hasStyleProperty=function(t){var e=this.getStyles();return void 0!==e&&null!==e&&e.hasProperty(t)},this.dropProperty=function(t){return this.hasProperty(t)?r.dropProperty(t):void 0},this.dropStyleProperty=function(t){return this.hasStyleProperty(t)?this.getStyles().dropProperty(t):void 0},this.setWidth=function(t){void 0!==t&&r.setWidth(t)},this.getWidth=function(){var t=this.getProperties();return t?t.getWidth():void 0},this.getWidthValue=function(){var t=this.getWidth();if(void 0!==t){var e=parseFloat(t);if(!isNaN(e))return e}},this.getElements=function(){var t=this.getContent();return t?t.getElements():void 0},this.setElements=function(t){Array.isArray(t)&&i.setElements(t)},this.getElem=function(t){return this.getContent().getElem(t)},this.getFirst=function(){return this.getContent().getFirst()},this.getLast=function(){return this.getContent().getLast()},this.insertElemAt=function(t,e){i.insertElemAt(t,e)},this.appendElem=function(t){i.appendElem(t)},this.length=function(){return this.getContent().length()},this.dropElemAt=function(t){return i.dropElemAt(t)},this.dropFirst=function(){i.dropFirst()},this.dropLast=function(){i.dropLast()},this.openingTag=function(){var t,e=this.getTag();return"string"==typeof e&&e.length>0?(t=this.getProperties(),t=t&&"function"==typeof t.toString?t.toString():"",t.length>0&&(t=" "+t),"<"+e+t+">"):void 0},this.closingTag=function(){var t=this.getTag();return"string"==typeof t&&t.length>0?"</"+t+">":void 0},this.toHtml=function(){var t,e=this.getTag(),n=this.openingTag(),r=this.closingTag(),i=this.getContent().toHtml();return t="string"==typeof e&&e.length>0?n+i+r:"<!-- tag name is missing -->"},this.toText=function(){return this.getContent().toText()},this.isEmpty=function(){return this.getProperties().isEmpty()&&this.getContent().isEmpty()},this.flushContent=function(){i.flush()},this.flushProperties=function(){r=new Properties},this.trim=function(){i.trim()},this.appendElemIfNotEmpty=function(t){i.appendElemIfNotEmpty(t)},this.clone=function(){var t,e,n,r=window[this.getName()];t="function"==typeof r?new r:new Tag;for(e in this)this.hasOwnProperty(e)&&(n=this[e],t[e]=n&&"function"==typeof n.clone?n.clone():n);return t},this.loadFromElement=function(t){var e,n,r,o,s,h,a=!1,l=!1,p=[];if(t instanceof Element){for(n=t.childNodes,h=n.length,this.setTag(t.tagName.toLowerCase()),o=t.attributes,o&&(e=this.getProperties(),a=e.load(o),this.setProperties(e)),s=0;h>s;s++)r=n.item(s),p.push(r);l=i.load(p)}return a&&l},this.loadIntoElement=function(t){var e,n,r=this.getProperties().getCore();for(e in r)if(r.hasOwnProperty(e)){n=r[e],n&&"function"==typeof n.toString&&(n=n.toString());try{t.setAttribute(e,n)}catch(i){console.log(i.name+" occurred when loading properties on the element: "+i.message)}}},this.extractFromTemplate=function(t,e){var n={};return e.forEach(function(e){t.hasOwnProperty(e)&&(n[e]=t[e])}),n},this.toNode=function(){var t=document.createElement(this.getTag());return this.getProperties().decorateElement(t),this.getContent().stickTo(t),t},this.setTitle=function(t){"string"==typeof t&&t.length>0?this.setProperty("title",t):this.dropProperty("title")},this.applyToAll=function(t){i&&"function"==typeof t&&i.applyToAll(t)},this.mark=function(t){this.setMarker(t),this.setProperty(t,this.getName())},this.unmark=function(){var t=this.getMarker();t&&(this.dropProperty(t),o=null)},this.shrinkBy=function(t){r.shrinkBy(t)},this.setStylePropertyToAll=function(t,e){var n,r,i=new Content,o=this.length();for(n=0;o>n;n++)r=this.getElem(n),r.setStyleProperty(t,e),i.appendElem(r);this.setContent(i)},this.setStylePropertyOfRange=function(t,e,n){if(!Array.isArray(n)&&null!==n&&void 0!==n)throw new Error("Range must be an array!");var r,i,o=new Content,s=this.length(),h=null===n||void 0===n;for(r=0;s>r;r++)i=this.getElem(r),(h||-1!==n.indexOf(r))&&i.setStyleProperty(t,e),o.appendElem(i);this.setContent(o)},this.getStylePropertyOfRange=function(t,e){if(!Array.isArray(e)&&null!==e&&void 0!==e)throw new Error("Range must be an array!");if(Array.isArray(e)&&0===e.length)return null;var n=this.length();if(null===e||void 0===e){e=[];var r;for(r=0;n>r;r++)e.push(r);return this.getStylePropertyOfRange(t,e)}var i,o;return e=e.map(function(t){return 0>t?n+t:t}),e.forEach(function(e){try{o=this.getElem(e).getStyleProperty(t)}catch(n){console.log("Error ("+n.message+") when retrieving style property "+t+" of element n. "+e),o=null}if(void 0===i)i=o;else if(i!==o)return null}.bind(this)),i},this.template=function(){var t={},e=this.getTag(),n=this.getContent(),r=this.getProperties();if(e&&(t.tag=e),r){var i=r.template();"object"==typeof i&&0!==Object.keys(i).length&&(t.root=i)}if(n){var o=n.template();Array.isArray(o)&&o.length>0&&(t.children=o)}return t},this.loadTemplate=function(t){this.loadProperTemplate(t),this.loadChildTemplates(this.extractChildTemplates(t))},this.loadProperTemplate=function(t){var e=this.getProperties();e.appendProperty(this.extractProperTemplate(t)),this.setProperties(e)},this.loadChildTemplates=function(t){var e=this.getContent();e&&(e.loadTemplateBunch(t),this.setContent(e))},this.extractProperTemplate=function(t){return t.root||{}},this.extractChildTemplates=function(t){return t.children||[]}}Tag.prototype.characteristicFunction=function(t){return t instanceof Node};
function UList(){"use strict";return this instanceof UList?(List.call(this),this.setTag("ul"),void this.setName("UList")):new UList}UList.prototype=Object.create(List.prototype),UList.prototype.characteristicFunction=function(t){return t instanceof Element&&"ul"===t.tagName.toLowerCase()};