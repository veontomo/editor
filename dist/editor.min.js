function CCell(){"use strict";return this instanceof CCell?(Controller.call(this),void this.setModel(Cell)):new CCell}CCell.prototype=Object.create(Controller.prototype);
function CDownload(){"use strict";if(!(this instanceof CDownload))return new CDownload;Controller.call(this);var e="php/saveDraft.php",t="php/downloadFile.php";this.downloadAsHtml=function(e,t){try{var o,n,a,s=e.getValueOf("tab-general","filename"),i=e.getValueOf("tab-general","mode"),l=t.document.getBody().$;a=Helper.cssOfSelector("body",NEWSLETTER.cssBase),n=new Document(l),n.setWrapCss(a),n.clean([/\bclass/,/\bid/,NEWSLETTER["marker-name"],/\bdata-.*/]),n.convertTo(i),o=n.docHtml(),this.downloadFile(o,s)}catch(r){this.showMessage(r.name+": "+r.message)}},this.downloadRaw=function(e,t){try{var o=t.getSnapshot(),n=e.getValueOf("basic","filename");this.downloadFile(o,n)}catch(a){this.showMessage(a.name+": "+a.message)}},this.appendTimeStamp=function(e){e="string"==typeof e?e:"";var t=new Date,o=e+[t.getFullYear(),("0"+(t.getMonth()+1)).slice(-2),("0"+t.getDate()).slice(-2),("0"+t.getHours()).slice(-2),("0"+t.getMinutes()).slice(-2),("0"+t.getSeconds()).slice(-2)].join("-")+".html";return o},this.downloadFile=function(o,n){return"string"!=typeof o?void this.showMessage("Can not download non-string content!"):void $.post(e,{data:o,filename:n},function(e){$(location).attr("href",t+"?filename="+e)})},this.file}CDownload.prototype=Object.create(Controller.prototype);
function Cell(t){"use strict";return this instanceof Cell?(Tag.call(this,t),this.setTag("td"),this.setName("Cell"),this.setProperties(new CellProperties),void this.setContent(new Content(t))):new Cell(t)}Cell.prototype=Object.create(Tag.prototype),Cell.prototype.characteristicFunction=function(t){return t instanceof Element&&"td"===t.tagName.toLowerCase()};
function CellProperties(e){"use strict";if(!(this instanceof CellProperties))return new CellProperties(e);Properties.call(this,e),this.setName("CellProperties");var t={"border-style":"none",width:0,padding:0,margin:0,"vertical-align":"top",color:"#000001","text-align":"justify"};this.initializeStyle();var r=this.getStyles();r.suggestProperty(t),this.setStyles(r)}CellProperties.prototype=Object.create(Properties.prototype);
function CImage(){"use strict";return this instanceof CImage?(Controller.call(this),this.setModel(ImageTag),this.onOk=function(t,e,r){var o,i,a,n,s,g,l;try{if(o=this.getEditorAdapter(),l=o.getCursorPosition(e),!l)return;if(i=this.getWorker(),a=o.getEditorContent(e),n=o.getDialogData(t),s=o.dialogToTemplate(n,"img"),g=i.createFromTemplate(s),!g)return;g=g.toNode(),r&&r.target?i.replaceChild(g,r.target):i.insertAt(l.startContainer,g,l.startOffset),o.setEditorContent(e,a)}catch(c){console.log(c.name+" occurred when inserting image: "+c.message)}},void(this.validateUrl=function(t){var e="string"==typeof t&&t.trim().length>0;return e})):new CImage}CImage.prototype=Object.create(Controller.prototype);
function CKEditorAdapter(){"use strict";return this instanceof CKEditorAdapter?(EditorAdapter.call(this),this.getEditorContent=function(e){return e instanceof CKEDITOR.editor?e.document.getBody().$:void 0},this.setEditorContent=function(e,t){if(e instanceof CKEDITOR.editor&&t instanceof Node)try{this.cleanLinks(t),e.setData(t.outerHTML)}catch(o){console.log(o.name+" occurred when setting up the editor content: "+o.message)}},this.cleanLinks=function(e){var t,o,r="data-cke-saved-href",n=e.getElementsByTagName("a"),a=n.length;for(o=0;a>o;o++)t=n.item(o),t.hasAttribute(r)&&t.setAttribute(r,t.getAttribute("href"))},this.getEditorRanges=function(e){if(e instanceof CKEDITOR.editor){var t=e.getSelection();if(t)return t.getRanges()}},this.toNativeRange=function(e){if(e instanceof CKEDITOR.dom.range){var t=document.createRange(),o=e.startOffset,r=e.endOffset,n=e.startContainer,a=e.endContainer;try{t.setEnd(a.$,r),t.setStart(n.$,o)}catch(i){console.log("Error ("+i.name+") detected when setting up the range: "+i.message)}finally{return t}}},this.fillInDialog=function(e,t){var o,r,n,a;for(o in t)if(o&&t.hasOwnProperty(o)){r=t[o];for(n in r)if(n&&r.hasOwnProperty(n)&&(a=r[n],void 0!==a))try{e.setValueOf(o,n,a)}catch(i){console.log(i.name+" when filling in the dialog menu item ("+o+", "+n+") with value "+a+": "+i.message)}}},this.templateToDialog=function(e){var t=e.name.toLowerCase(),o=t+"TemplateToDialog",r=this[o];console.log("search for "+t+" template"),"function"!=typeof r&&(r=this.defaultTemplateToDialog);try{return r(e)}catch(n){console.log(n.name+" when transforming a template into dialog data: "+n.message)}},this.defaultTemplateToDialog=function(e){return console.log("default template -> dialog converter is called"),e},this.tableDialogToTemplate=function(e){var t={name:"table",root:{style:{margin:e.table.margin,padding:e.table.padding,"border-width":e.table["border-width"],"border-color":e.table["border-color"],background:e.table.background}},frame:{width:e.rows.frameWidth,color:e.rows.frameColor},rows:e.table.rows,columns:e.table.columns,row:{name:"row",root:{style:{margin:e.rows.margin,padding:e.rows.padding,"border-width":e.rows["border-width"],"border-color":e.rows["border-color"]}},"border-first":e.rows.borderFirst,"border-last":e.rows.borderLast,"border-middle":e.rows.borderMiddle},cell:{name:"cell",root:{style:{margin:e.cells.margin,padding:e.cells.padding}},"border-first":e.cells.borderFirst,"border-last":e.cells.borderLast,"border-middle":e.cells.borderMiddle}};return t},this.tableTemplateToDialog=function(e){console.log("tableTemplateToDialog input:",e);var t={structure:{rows:e.root.rows,cols:e.root.cols},spaces:{margin:e.root.margin,padding:e.root.padding,"border-spacing":e.root["border-spacing"]},borders:{}};return t},this.linkTemplateToDialog=function(e){return{linkInfoTab:e.root}},this.linkDialogToTemplate=function(e){var t,o="linkInfoTab";return t={name:"link",root:{href:e[o].href,target:e[o].isTargetBlank?"_blank":"_self",title:e[o].title,style:{color:e[o].color,"text-decoration":e[o].isUnderlined?"underline":"none"}}}},this.imgDialogToTemplate=function(e){var t="mainTab",o={name:"img",root:{src:e[t].imageUrl,alt:e[t].textAlt,title:e[t].textAlt}};return o},this.defaultDialogToTemplate=function(e){return console.log("default dialog -> template converter is called"),{tab:e.root}},this.imgTemplateToDialog=function(e){var t={mainTab:{imageUrl:e.root.src,textAlt:e.root.alt||e.root.title}};return t},this.dialogToTemplate=function(e,t){var o="string"==typeof t?t.toLowerCase():"default",r=o+"DialogToTemplate",n=this[r];return"function"!=typeof n&&(n=this.defaultDialogToTemplate),n(e)},this.getDialogData=function(e,t){var o,r,n,a,i,l={},s=e._.contents,d=void 0===t||!Array.isArray(t);for(o in s)if(s.hasOwnProperty(o)){r=s[o],a={};for(n in r)if(r.hasOwnProperty(n)&&(d||-1!==t.indexOf(r[n].type)))try{i=e.getValueOf(o,n),void 0!==i&&(a[n]=e.getValueOf(o,n))}catch(c){console.log(c.name+": retrieving dialog element ("+o+", "+n+")")}l[o]=a}return l},this.getCursorPosition=function(e){try{var t=e.getSelection(),o=t.getRanges();return this.toNativeRange(o[0])}catch(r){return void console.log(r.name+": when detecting cursor position ("+r.message+")")}},this.setDialogInputField=function(e,t){var o,r,n;try{o=t.tabId,r=t.elemId,n=t.value,e.setValueOf(o,r,n)}catch(a){console.log(a.name+" when setting dialog input field:"+a.message)}},this.setDialogHtmlField=function(e,t){var o,r,n;try{o=t.tabId,r=t.elemId,n=e.getContentElement(o,r),CKEDITOR.document.getById(n.domId).$.innerHTML=t.value}catch(a){console.log(a.name+" when setting dialog html field:"+a.message)}},this.toNativeElement=function(e){return e instanceof CKEDITOR.dom.element?e.$:void 0},this.saveExtra=function(e,t){e.extraDataToStoreHere=t},this.getExtra=function(e){return e.extraDataToStoreHere},this.disableField=function(e,t){var o;for(o in t)t.hasOwnProperty(o)&&e.getContentElement(o,t[o]).disable()},this.isFieldEnabled=function(e,t){var o,r;try{r=Object.keys(t),o=e.getContentElement(r[0],t[r[0]]).isEnabled()}catch(n){console.log(n.name+" occurred when determining the status of dialog field: "+n.message),console.log("Treat it as if the field is disabled..."),o=!1}return o},void(this.getFieldValue=function(e,t){var o;try{return o=Object.keys(t),e.getValueOf(o[0],t[o[0]])}catch(r){console.log(r.name+" occurred when retrieving value of dialog field: "+r.message)}})):new CKEditorAdapter}CKEditorAdapter.prototype=Object.create(EditorAdapter.prototype);
var CKHelper={findAscendant:function(e,t){if("function"!=typeof t)return null;for(;e&&e.type===CKEDITOR.NODE_ELEMENT;){if(t(e))return e;e=e.getParent()}return null},dropInlineStyleAttr:function(e,t){var n=e.attr("style"),r=new Properties(n);r.dropProperty(t),r.setMode(1),e.attr("style",r.toString())},unlink:function(e,t){if(!(e instanceof CKEDITOR.editor&&t instanceof CKEDITOR.dom.element))return null;var n=t.$,r=n.parentNode,i=n.nextSibling,o=NEWSLETTER.factory,a=o.mimic(n);a.getContent().getElements().forEach(function(e){r.insertBefore(e.toNode(),i)}),n.remove()},dropRow:function(e){var t,n,r=CKHelper.findAscendant(e.getSelection().getStartElement(),function(e){return"tr"===e.getName()&&"Row"===e.getAttribute(NEWSLETTER["marker-name"])});r&&(t=CKHelper.findAscendant(r,function(e){return"table"===e.getName()}),r.remove(),n=t.getElementsByTag("tr").count(),0===n&&t.remove())},isEditor:function(e){return e instanceof CKEDITOR.editor},isSelection:function(e){return e instanceof CKEDITOR.dom.selection},insertRow:function(e,t){for(var n,r,i,o,a,l,E,s="tr",u=NEWSLETTER["marker-name"],c="Row",f=e.getSelection().getStartElement(),m=f.getAscendant(s,!0);m.getName()!==s||m.getAttribute(u)!==c;)if(m=m.getParent(),!m||m.type!==CKEDITOR.NODE_ELEMENT)return null;if(n=new CKEDITOR.dom.element(s),r="insert"+Helper.firstLetterUpperCase(t),i=m.getChildren(),o=i.count(),void 0===n[r])return null;for(n[r](m),m.copyAttributes(n),a=0;o>a;a++)l=i.getItem(a),E=new CKEDITOR.dom.element(l.getName()),E.setHtml(m.getChild(a).getHtml()),n.append(E),l.copyAttributes(E)},insertColumn:function(e,t){if("before"!==t&&"after"!==t)return null;var n,r,i,o,a,l,E,s,u,c,f,m,p,g;n=CKHelper.findAscendant(e.getSelection().getStartElement(),function(e){var t=(new Cell).getName();return"td"===e.getName()&&e.getAttribute(NEWSLETTER["marker-name"])===t}),l=CKHelper.findAscendant(e.getSelection().getStartElement(),function(e){var t=(new Table).getName();return"table"===e.getName()&&e.getAttribute(NEWSLETTER["marker-name"])===t}),a=n.getIndex(),r=NEWSLETTER.factory.mimic(n.$),p=NEWSLETTER.factory.mimic(l.$),i=r.getStyles(),o=r.getProperties(),f=p.getProfile().map(function(e){return parseFloat(e)}),E=Helper.crack(f,a),s=new Cell("cella"),u=new Properties(o),c=new Properties(i),"before"===t&&(g=0,c.setProperty("padding-right",0),p.appendStyleToCol(a,"padding-left: 0px")),"after"===t&&(g=1,c.setProperty("padding-left",0),p.appendStyleToCol(a,"padding-right: 0px")),s.setProperties(u),s.setStyles(c),s.setProperty(NEWSLETTER["marker-name"],(new Cell).getName()),p.insertColAt(a+g,s),p.setProfile(E),m=CKEDITOR.dom.element.createFromHtml(p.toHtml()),l.remove(),e.insertElement(m)},nodeString:function(e){return e.type===CKEDITOR.NODE_ELEMENT?e.getOuterHtml():e.type===CKEDITOR.NODE_TEXT?e.getText():"..."},nodeOffsetString:function(e,t,n){if(e.type===CKEDITOR.NODE_ELEMENT)return CKHelper.nodeString(e.getChild(t));if(e.type===CKEDITOR.NODE_TEXT){if("start"===n||void 0===n)return e.getText().substring(0,t);if("end"===n)return e.getText().substring(t)}return"wrong"},insertNode:function(e,t){t.type===CKEDITOR.NODE_ELEMENT&&e.push(t)},arrayToText:function(e,t){return t=t||"",e.map(function(e){var t;switch(e.type){case CKEDITOR.NODE_ELEMENT:t=e.textContent;break;case CKEDITOR.NODE_TEXT:t=e.getText();break;default:t="..."}return t}).join(t)},doesOverlap:function(e,t){var n=!1;return n=e.type===t.type&&e.type===CKEDITOR.NODE_ELEMENT?e.equals(t)||e.contains(t)||t.contains(e):e.type===CKEDITOR.NODE_ELEMENT?e.contains(t):e.type===CKEDITOR.NODE_ELEMENT?t.contains(e):e.equals(t)},insertList:function(e,t){var n=new Selection(e),r=n.nodes,i=NEWSLETTER.factory;console.log("CKHelper::insertListNew ",r),r.forEach(function(n){var r,o,a,l,E,s=n.length;if(o=new List(t),0===s)return o.appendElem(new ListItem),l=CKEDITOR.dom.element.createFromHtml(o.toHtml()),e.insertElement(l),null;if(E=n.shift().$,1===s&&E.nodeType===Node.ELEMENT_NODE)return r=i.mimic(E),a=r.getContent(),o=new List(t),o.appendAsItems(a),r.setElements([o]),l=r.toNode(),E.parentNode.replaceChild(l,E),null;var u=[i.mimic(E)];n.forEach(function(e){u.push(i.mimic(e.$)),e.$.remove()}),o.appendAsItems(u),l=o.toNode(),E.parentNode.replaceChild(l,E)})},changeListType:function(e,t,n){var r,i,o;t&&(r=new List,r.load(t.$),r.switchName(n),r.trim(),o=r.toHtml(),i=CKEDITOR.dom.element.createFromHtml(o),t.remove(),e.insertElement(i))},"next-siblings":function(e){for(var t=[],n=e;n.hasNext();)n=n.getNext(),t.push(n);return t},"prev-siblings":function(e){for(var t=[],n=e;n.hasPrevious();)n=n.getPrevious(),t.push(n);return t},"bunch-next-siblings":function(e,t){if(e.equals(t))return[e];if(!t.contains(e))return[];for(var n=[e],r=e,i=r.getParent(),o=CKHelper["next-siblings"];!t.equals(i);)n=n.concat(o(r)),r=i,i=i.getParent();return n=n.concat(o(r))},"bunch-prev-siblings":function(e,t){if(e.equals(t))return[e];if(!t.contains(e))return[];for(var n=[e],r=e,i=r.getParent(),o=CKHelper["prev-siblings"];!t.equals(i);)n=n.concat(o(r)),r=i,i=i.getParent();return n=n.concat(o(r))},childWithNode:function(e,t){var n,r,i,o;if(e.contains(t))for(n=e.getChildren(),r=n.count(),i=0;r>i;i++)if(o=n.getItem(i),CKHelper.containsOrEqual(o,t))return o;return null},containsOrEqual:function(e,t){var n=e.type;return n===CKEDITOR.NODE_ELEMENT?e.contains(t)||e.equals(t):n===CKEDITOR.NODE_TEXT?e.equals(t):!1}};
function CLink(){"use strict";return this instanceof CLink?(Controller.call(this),this.setModel(Link),this.onOk=function(t,e,i){var n,o,r,l,s,a,c,d,g;try{if(n=this.getEditorAdapter(),c=n.getCursorPosition(e),!c)return;o=this.getWorker(),r=n.getEditorContent(e),l=n.getDialogData(t),s=n.dialogToTemplate(l,"link"),a=o.createFromTemplate(s),g={linkInfoTab:"content"},d=n.isFieldEnabled(t,g)===!0,d&&a.setContent(n.getFieldValue(t,g)),i&&i.target?o.modifyLink(i.target,a.toNode()):i&&i.selection?o.isSelectionEditable(i.selection)?o.replaceSelectionByLink(i.selection,a.toNode()):o.selectionToLink(i.selection,a.toNode()):o.insertAt(c.startContainer,a.toNode(),c.startOffset),n.setEditorContent(e,r)}catch(h){console.log(h.name+" occurred when inserting link: "+h.message)}},this.fillInDialogWithSelection=function(t,e){var i,n,o,r,l;try{i=this.getEditorAdapter(),n=i.getNativeRanges(e),o=this.getWorker(),r=o.findSelectionFirstAncestor(n,this.getModel().prototype.characteristicFunction),l=o.selectionToString(n),r&&(this.fillInDialogWithElement(t,r),this.saveExtra(t,r)),l&&this.setDialogInputField(t,{tabId:"linkInfoTab",elemId:"content",value:l})}catch(s){console.log(s.name+" occurred when filling in link dialog: "+s.message)}},void(this.unlink=function(t,e){var i,n,o;try{i=this.getEditorAdapter(),n=this.getWorker(),o=i.getEditorContent(t),n.clearNodeFromLink(e),i.setEditorContent(t,o)}catch(r){console.log(r.name+" occurred when stripping link: "+r.message)}})):new CLink}CLink.prototype=Object.create(Controller.prototype);
function CList(){"use strict";return this instanceof CList?(Controller.call(this),this.setModel(List),this.insertLists=function(t,e){var i,n,o,r;try{i=this.getEditorAdapter(),n=this.getWorker(),o=i.getEditorContent(t),r=i.getNativeRanges(t),n.selectionToList(r,e),i.setEditorContent(t,o)}catch(s){console.log(s.name+" occurred when converting editor content into a list: "+s.message)}},this.changeListType=function(t,e,i){var n,o,r;try{n=this.getEditorAdapter(),o=this.getWorker(),r=n.getEditorContent(t),o.setListNodeType(e,i),n.setEditorContent(t,r)}catch(s){console.log(s.name+" occurred when changing list type: "+s.message)}},void(this.findListAncestorOfType=function(t,e){var i=this.getEditorAdapter(),n=i.toNativeElement(t);if(n){var o=this.getWorker(),r=function(t){return t instanceof Element&&t.tagName.toLowerCase()===e};return o.findAncestor(n,r)}})):new CList}CList.prototype=Object.create(Controller.prototype);
function Content(t){"use strict";if(!(this instanceof Content))return new Content(t||null);var n="Content",e=t?[t]:[];this.getName=function(){return n},this.getElements=function(){var t=[];return e.forEach(function(n){var e="function"==typeof n.clone?n.clone():n;t.push(e)}),t},this.setElements=function(t){Array.isArray(t)&&(e=t)},this.length=function(){return e.length},this.getElem=function(t){var n=e[t];return void 0!==n?"function"==typeof n.clone?n.clone():n:null},this.getFirst=function(){return this.getElem(0)},this.getLast=function(){var t=this.length();return t>0?this.getElem(t-1):null},this.insertElemAt=function(t,n){var i=this.length(),r=parseInt(t,10)===t;if(!r||0>t||t>i)throw new Error("Wrong index to insert the element at!");return t===i?this.appendElem(n):e.splice(t,0,n),null},this.flush=function(){e=[]},this.appendElem=function(t){return void 0!==t&&(t instanceof Content?this.absorb(t):e.push(t)),null},this.absorb=function(t){if(t instanceof Content){var n=t.getElements();n.forEach(function(t){e.push(t)})}},this.dropElemAt=function(t){var n=e[t];return void 0!==n?(e.splice(t,1),n):void 0},this.dropFirst=function(){this.dropElemAt(0)},this.dropLast=function(){var t=this.length();t>0&&this.dropElemAt(t-1)},this.toHtml=function(){var t,n,e,i="",r=this.length();for(t=0;r>t;t++)switch(n=this.getElem(t),typeof n){case"string":i+=n;break;case"number":i+=n.toString();break;default:e="function"==typeof n.toHtml,i+=e?n.toHtml():"<!-- no html representation -->"}return i},this.toText=function(){var t,n,e="",i=this.length();for(t=0;i>t;t++)switch(n=this.getElem(t),typeof n){case"string":e+=n;break;case"number":e+=n.toString();break;default:"function"==typeof n.toText&&(e+=n.toText())}return e},this.isEmpty=function(){var t,n,e,i=!0,r=this.length();for(t=0;r>t;t++)if(n=this.getElem(t),"function"==typeof n.isEmpty){if(i=n.isEmpty(),!i)return!1}else{if(e=typeof n,"number"===e)return!1;if("string"===e)return"&nbsp;"===n||""===n;if("object"===e&&0!==Object.getOwnPropertyNames(n).length)return!1}return i},this.isElemEmpty=function(t){switch(typeof t){case"object":if("function"==typeof t.isEmpty)return t.isEmpty();if(0===Object.getOwnPropertyNames(t).length)return!0;if(Array.isArray(t))return 0===t.length;break;case"string":if(""===t)return!0}return!1},this.appendElemIfNotEmpty=function(t){this.isElemEmpty(t)||this.appendElem(t)},this.load=function(t){if(Array.isArray(t)&&NEWSLETTER.factory){{var n=NEWSLETTER.factory,e=[];t.length}return t.forEach(function(t){var i=n.mimic(t);e.push(i)}),this.setElements(e),!0}return!1},this.stickTo=function(t){"function"==typeof t.appendChild&&e.forEach(function(n){t.appendChild("function"==typeof n.toNode?n.toNode():document.createTextNode(n))})},this.clone=function(){var t=new Content;return e.forEach(function(n){var e="function"==typeof n.clone?n.clone():n;t.appendElem(e)}),t},this.appendStyleToElemAt=function(t,n){var i=e[t];void 0!==i&&"function"==typeof i.appendStyle&&i.appendStyle(n)},this.findTagPos=function(t){var n=[];return e.forEach(function(e,i){e&&"function"==typeof e.getTag&&e.getTag()===t&&n.push(i)}),n},this.getFirstEntryOfTag=function(t){for(var n,e=this.length(),i=0;e>i;){if(n=this.getElem(i),"function"==typeof n.getTag&&n.getTag()===t)return n;i++}},this.filterOut=function(t){var n=e.filter(function(n){return t(n)});e=n},this.applyToAll=function(t){e&&"function"==typeof t&&e.forEach(function(n){t(n)})},this.template=function(){var t=this.getElements(),n=[];return Array.isArray(t)&&t.length>0&&t.forEach(function(t){var e;try{e=t.template()}catch(i){e=null}n.push(e)}),n},this.loadTemplateBunch=function(t){var n=this.getElements();if(Array.isArray(n)&&Array.isArray(t)&&0!==t.length){var e,i,r=n.length;for(e=0;r>e;e++)try{t[e]&&(i=t[e]),n[e].loadTemplate(i)}catch(o){console.log(o.name+" when loading template into child n."+e+": "+o.message)}this.setElements(n)}}}
function Controller(){"use strict";if(!(this instanceof Controller))return new Controller;var t;this.setContent=function(e){t=e instanceof Node?e:void 0},this.getContent=function(){return t};var e;this.setWorker=function(t){e=t},this.getWorker=function(){return e};var o;this.getEditorAdapter=function(){return o},this.setEditorAdapter=function(t){o=t},this.getEditorSelection=function(t){var e;try{return e=this.getEditorAdapter(),e.getNativeRanges(t)}catch(o){console.log(o.name+" occurred when retrieving editor selection: "+o.message)}};var i;this.setModel=function(t){i=t},this.getModel=function(){return i},this.disableField=function(t,e){var o;try{o=this.getEditorAdapter(),o.disableField(t,e)}catch(i){console.log(i.name+": failed to disable the dialog field. Message: "+i.message)}},this.showMessage=function(t){alert("string"==typeof t?t:"Error occurred!")},this.onLoad=function(t,e,o){console.log(t,e,o)},this.onShow=function(t,e,o){console.log(t,e,o)},this.onOk=function(t,e,o){console.log(t,e,o)},this.onCancel=function(t,e,o){console.log(t,e,o)},this.templateToDialog=function(t,e){try{var o=this.getEditorAdapter(),i=o.templateToDialog(t,e);return i}catch(n){console.log(n.name+" occurred when converting template to dialog: "+n.message)}},this.dialogToTemplate=function(t,e){try{var o=this.getEditorAdapter(),i=o.templateToDialog(t,e);return i}catch(n){console.log(n.name+" occurred when converting dialog to template: "+n.message)}},this.findRepresentativeAncestor=function(t){var e=this.getEditorAdapter(),o=e.toNativeElement(t);if(o)return this.findRepresentativeAncestorOfNode(o)},this.findRepresentativeAncestorFromCursorPosition=function(t){var e=this.getEditorAdapter(),o=e.getCursorPosition(t);if(o){var i=o.startContainer;return this.findRepresentativeAncestorOfNode(i)}},this.findRepresentativeAncestorOfNode=function(t){var e,o,i,n=this.getWorker(),r=this.getModel();return r&&(o=r.prototype,o&&(e=o.characteristicFunction)),"function"==typeof e&&(i=n.findAncestor(t,e)),i},this.fillInDialogWithElement=function(t,e){var o,i,n,r,s;try{if(o=this.getEditorAdapter(),i=this.getWorker(),n=i.getFactory().mimic(e),!n)return;s=n.template(),r=o.templateToDialog(s),console.log("data to fill in the dialog: ",r),o.fillInDialog(t,r)}catch(a){console.log(a.name+" occurred when filling in dialog with data: "+a.message)}},this.fillInDialogWithSelection=function(t,e){console.log(t,e),console.warn("Controller.fillInDialogWithSelection() is called, but its implementation is trivial (it does nothing).")},this.saveExtra=function(t,e){var o;try{o=this.getEditorAdapter(),o.saveExtra(t,e)}catch(i){console.log(i.name+" occurred when saving extra information: ",i.message)}},this.getExtra=function(t){var e;try{return e=this.getEditorAdapter(),e.getExtra(t)}catch(o){console.log(o.name+" occurred when getting extra information: "+o.message)}},this.setDialogInputField=function(t,e){var o=this.getEditorAdapter();o.setDialogInputField(t,e)},this.setDialogHtmlField=function(t,e){var o=this.getEditorAdapter();o.setDialogHtmlField(t,e)},this.createModel=function(){var t;try{if(t=this.getModel(),"function"==typeof t)return new t}catch(e){console.log(e.name+" occurred when controller was creating an element: "+e.message)}},this.isNodeEditable=function(t){var e,o;try{e=this.getWorker(),o=e.isNodeEditable(t)}catch(i){console.log(i.name+": the node is assigned as non-editable because "+i.message),o=!1}return o},this.isSelectionEditable=function(t){var e,o;try{e=this.getWorker(),o=e.isSelectionEditable(t)}catch(i){console.log(i.name+": the node is assigned as non-editable because "+i.message),o=!1}return o},this.removeNode=function(t,e){var o,i,n;try{o=this.getEditorAdapter(),n=o.getEditorContent(t),i=this.getWorker(),i.removeNode(e),o.setEditorContent(n)}catch(r){console.log(r.name+" occurred when removing a node: "+r.message)}}}
function Converter(e){"use strict";if(!(this instanceof Converter))return new Converter(e);var n=e instanceof Mapper?e:new Mapper;this.getMapper=function(){return n},this.setMapper=function(e){e instanceof Mapper&&(n=e)},this.convertTo=function(e,n,r){var t=this.getMapper(),i=t.findTargetFor(n);if(i){var o=new i;return o.convert(e,r)}}}
function ConverterElastic(){"use strict";if(!(this instanceof ConverterElastic))return new ConverterElastic;ConverterGeneral.call(this);var t=5,e=function(t){var e="width";if(t.hasAttribute("data-original-width"))return t.getAttribute("data-original-width");if(t.hasAttribute(e))return t.getAttribute(e);var r=new Properties(t.getAttribute("style"));if(r.hasProperty(e))return r.getProperty(e);var i=t.offsetWidth;return void 0!==i?i:void 0},r=function(r,i){if(r.nodeType!==Node.ELEMENT_NODE)return void 0;var n,o,a,d,s="data-original-width";void 0!==i&&(n=e(i)),n||(n=NEWSLETTER.width()),a=new Unit(n),a.suggestMeasure(NEWSLETTER.unitMeasure());var g=new Properties;if(g.loadNodeProperties(r),o=g.getWidth(),void 0===o)return void 0;o=new Unit(o),o.suggestMeasure(NEWSLETTER.unitMeasure());try{d=o.frac(a,t).toPercent(),g.setWidth(d.toString()),g.dropStyleProperty("max-width"),g.dropStyleProperty("min-width"),g.decorateElement(r),r.setAttribute(s,o.toString())}catch(u){console.log("Error when dividing "+o.toString()+" and "+a.toString())}},i=function(e,r){if(e.nodeType!==Node.ELEMENT_NODE)return void 0;var i,n,o,a,d="font-size",s="data-original-"+d;i=r&&r.hasAttribute(s)?r.getAttribute(s):NEWSLETTER.fontsize(),o=new Unit(i);var g=new Properties;if(g.loadNodeProperties(e),n=g.getStyleProperty(d),void 0===n)return void 0;n=new Unit(n),n.suggestMeasure(NEWSLETTER.unitMeasure());try{a=n.frac(o,t).toPercent(),g.setStyleProperty(d,a.toString()),g.decorateElement(e),e.setAttribute(s,n.toString())}catch(u){console.log("Error when dividing "+n.toString()+" and "+o.toString())}},n=function(r,i){if(r.nodeType!==Node.ELEMENT_NODE)return void 0;var n,o,a,d,s=["padding","padding-left","padding-right","padding-top","padding-bottom","margin","margin-left","margin-right","margin-top","margin-bottom"];void 0!==i&&(n=e(i)),n||(n=NEWSLETTER.width()),a=new Unit(n),a.suggestMeasure(NEWSLETTER.unitMeasure());var g=new Properties;g.loadNodeProperties(r),s.forEach(function(e){var i="data-original-"+e;if(o=g.getStyleProperty(e),void 0!==o){o=new Unit(o),o.suggestMeasure(NEWSLETTER.unitMeasure());try{d=o.frac(a,t).toPercent(),g.setStyleProperty(e,d.toString()),g.decorateElement(r),r.setAttribute(i,o.toString())}catch(n){console.log("Error when dividing "+o.toString()+" and "+a.toString())}}})},o=function(t,e){n(t,e)};this.setWorkers([i,r,o])}ConverterElastic.prototype=Object.create(ConverterGeneral.prototype);
function ConverterFixed(){"use strict";if(!(this instanceof ConverterFixed))return new ConverterFixed;ConverterGeneral.call(this);var e=function(e){if(e.nodeType!==Node.ELEMENT_NODE)return void 0;var t=NEWSLETTER.factory.mimic(e),r=t.getProperties(),i=t.getWidth();return void 0===i?void 0:(i=new Unit(i),i.hasMeasure()||i.setMeasure(NEWSLETTER.unitMeasure()),r.setWidth(i.getValue()),r.setStyleProperty("max-width",i.toString()),r.setStyleProperty("min-width",i.toString()),void r.decorateElement(e))},t=function(e){if(e.nodeType!==Node.ELEMENT_NODE)return void 0;var t=NEWSLETTER.factory.mimic(e);if(t instanceof List){var r=t.getProperties();r.setStyleProperty("margin-left","40px"),r.setStyleProperty("margin-top","0px"),r.setStyleProperty("margin-bottom","0px"),r.setStyleProperty("margin-right","0px"),r.decorateElement(e)}};this.setWorkers([e,t])}ConverterFixed.prototype=Object.create(ConverterGeneral.prototype);
function ConverterGeneral(){"use strict";if(!(this instanceof ConverterGeneral))return new ConverterGeneral;var e=[];this.setWorkers=function(e){e.forEach(function(e){try{this.appendWorker(e)}catch(r){console.log("Error: "+r)}}.bind(this))},this.getWorkers=function(){return e},this.numberOfWorkers=function(){return e.length},this.getWorker=function(r){return e[r]},this.appendWorker=function(r){return"function"==typeof r?(e.push(r),!0):!1},this.convert=function(e,r){var t,o=e.cloneNode(!0);return void 0!==r&&"function"==typeof r.cloneNode&&(t=r.cloneNode(!1)),this.process(o,t),o},this.process=function(e,r){if(this.processRoot(e,r),e.nodeType===Node.ELEMENT_NODE){var t,o=e.childNodes,n=o.length;for(t=0;n>t;t++)this.process(o.item(t),e)}},this.processRoot=function(e,r){var t,o=this.numberOfWorkers();for(t=0;o>t;t++)this.getWorker(t)(e,r)}}
function CRow(){"use strict";return this instanceof CRow?(Controller.call(this),void this.setModel(Row)):new CRow}CRow.prototype=Object.create(Controller.prototype);
function CTable(){"use strict";return this instanceof CTable?(Controller.call(this),this.setModel(Table),this.parentWidth=function(t){var e,n=t.getSelection().getStartElement(),i=new Unit(n.getComputedStyle("width")||NEWSLETTER.width()),o=new Unit(n.getComputedStyle("border-width-left")||0),r=new Unit(n.getComputedStyle("border-width-right")||0),a=new Unit(n.getComputedStyle("padding-left")||0),l=new Unit(n.getComputedStyle("padding-right")||0);return e=i.sub(o).sub(r).sub(a).sub(l),e.value=Math.round(e.value),e},this.create=function(t,e){var n=this.getDialogData(t,["text","checkbox"]),i=function(t,e){return(t+1).toString()+" : "+(e+1).toString()};n.width=this.parentWidth(e);var o=new Table;try{o.loadFromTemplate(this.dialogToTemplate(n),i)}catch(r){console.log(r)}return o.toNode()},this.getTable=function(t){var e=this.findParentTable(t);if(e){var n=NEWSLETTER.factory,i=n.mimic(e);if(i)return i.disentangle(),i}},this.addColWeightFields=function(t,e){if(t&&t.nodeType&&Number.isInteger(e)&&!(0>e)){var n,i;for(i=0;e>i;i++)n=document.createElement("input"),n.setAttribute("style","min-width: 3em; width: 5em; text-align: center; margin: 0.2em"),n.setAttribute("class","cke_dialog_ui_input_text"),t.appendChild(n)}},this.setColorField=function(t,e,n,i){if(i){var o=t.getContentElement(e,n);o&&(o.setValue(i),o.getInputElement().setStyle("background-color",i))}},this.findParentTable=function(t){var e=t.getSelection().getStartElement(),n=function(t){return"table"===t.tagName.toLowerCase()&&t.getAttribute(NEWSLETTER["marker-name"])===(new Table).getName()};return e?this.findAscendant(e.$,n):void 0},this.update=function(t,e,n){var i=new Table,o=this.getDialogData(t),r=NEWSLETTER.factory,a=r.mimic(n),l=a.getWidth()||NEWSLETTER.width();return a.disentangle(),o.width=new Unit(l),i=a.update(this.dialogToTemplate(o)),i.toNode()},this.insertColumn=function(t,e,n){var i=this.getEditorAdapter(),o=i.getEditorContent(t),r=this.getWorker();r.insertColumn(e,n),i.setEditorContent(t,o)},this.insertRow=function(t,e){console.log("insertRow: ",t,e)},this.dropRow=function(t){console.log("dropRow: ",t)},this.removeTable=function(t){var e,n,i,o;try{e=this.getEditorAdapter(),n=e.getEditorContent(t),o=e.getNativeRanges(t),i=this.getWorker(),i.clearRangesFromTables(o),e.setEditorContent(t,n)}catch(r){console.log(r.name+" occurred when removing tables: "+r.message)}},void(this.onOk=function(t,e,n){var i,o,r,a,l,s,d,g,c;try{i=this.getEditorAdapter(),o=i.getEditorContent(e),r=i.getDialogData(t,["text","checkbox"]),a=i.dialogToTemplate(r,"table"),s=this.getWorker(),n?s.updateNode(n,a):(g=i.getCursorPosition(e),c=g.startContainer,a.root.width=s.getAvailableWidth(c)||NEWSLETTER.defaultWidth,d=s.getFactory(),l=d.createFromTemplate(a),s.insertAt(c,l.toNode(),g.startOffset)),i.setEditorContent(e,o)}catch(u){console.log(u.name+" occurred when elaborating table plugin confirm action: "+u.message)}})):new CTable}CTable.prototype=Object.create(Controller.prototype);
function CTextDecoration(){"use strict";return this instanceof CTextDecoration?(Controller.call(this),this.convertToBold=function(t){var e,o,n,r;try{e=this.getEditorAdapter(),o=this.getWorker(),n=e.getEditorContent(t),r=e.getNativeRanges(t),o.convertToBold(r),e.setEditorContent(t,n)}catch(i){return void console.log(i.name+" occurred when converting selection into bold font: "+i.message)}},this.convertToItalics=function(t){var e,o,n,r;try{e=this.getEditorAdapter(),o=this.getWorker(),n=e.getEditorContent(t),r=e.getNativeRanges(t),o.convertToItalics(r),e.setEditorContent(t,n)}catch(i){return void console.log(i.name+" occurred when converting selection into italics: "+i.message)}},this.convertToStroked=function(t){var e,o,n,r;try{e=this.getEditorAdapter(),o=this.getWorker(),n=e.getEditorContent(t),r=e.getNativeRanges(t),o.convertToStroked(r),e.setEditorContent(t,n)}catch(i){return void console.log(i.name+" occurred when converting selection into stoked: "+i.message)}},void(this.convertToUnderlined=function(t){var e,o,n,r;try{e=this.getEditorAdapter(),o=this.getWorker(),n=e.getEditorContent(t),r=e.getNativeRanges(t),o.convertToUnderlined(r),e.setEditorContent(t,n)}catch(i){return void console.log(i.name+" occurred when converting selection into underlined: "+i.message)}})):new CTextDecoration}CTextDecoration.prototype=Object.create(Controller.prototype);
function Document(){"use strict";if(!(this instanceof Document))return new Document;var t,e=new Converter(NEWSLETTER.formatMapper||new Mapper);this.getConverter=function(){return e};var n;this.getFactory=function(){return n},this.setFactory=function(t){n=t},this.setWrapCss=function(e){t=e instanceof Properties?e:new Properties(e),t.setMode(Properties.MODE_STYLE)},this.getWrapCss=function(){return t},this.docHtml=function(t){var e=this.getWrapCss(),n=e?e.toString():"";n&&(n=' style="'+n+'"');var i=t instanceof Node?t.innerHTML:"",r='<!DOCTYPE html>\n<html>\n<head>\n<meta http-equiv="content-type" content="text/html; charset=utf-8">\n</head>\n<body>\n',o="<center>\n<div"+n+">\n"+i+"\n</div>\n</center>\n",s="</body>\n</html>";return r+o+s},this.convertTo=function(t,e){var n=this.getConverter();return"function"==typeof n.convertTo?n.convertTo(e,t):void 0},this.findAncestor=function(t,e,n){var i=void 0!==n;if(n&&"function"==typeof n.contains&&!n.contains(t))throw new Error("Wrong scope!");if("function"!=typeof e)throw new Error("Criteria must be a function!");for(var r,o=t;o&&(!i||n.contains(o));)try{if(r=e(o))return o}catch(s){console.log("Error ("+s.name+") when applying criteria to a node: "+s.message)}finally{o=o.parentNode}},this.findAncestorsOfMany=function(t,e){if(!Array.isArray(t)||"function"!=typeof e)return void 0;var n=[];return t.forEach(function(t){var i=this.findAncestor(t,e);i&&-1===n.indexOf(i)&&n.push(i)}.bind(this)),n},this.nodesBetween=function(t,e){if(!(t instanceof Node&&e instanceof Node))return[];if(t===e)return[t];var n=this.commonAncestor(t,e);if(!n)return[];var i=this.pathTo(t,n),r=this.pathTo(e,n);if(0===i.length)return[t];if(0===r.length)return[e];var o,s,a,c,f=i[0],h=r[0],u=[],d=this.compare(i,r);if(1===d||-1===d){1===d?(o=e,s=t,a=h,c=f):(o=t,s=e,a=f,c=h),u.push(o);var l=this.bunchNextSiblings(o,n.childNodes[a]),p=this.bunchPrevSiblings(s,n.childNodes[c]);Array.isArray(l)&&l.length>0&&(u=u.concat(l));var g;for(g=a+1;c>g;g++)u.push(n.childNodes[g]);return Array.isArray(p)&&p.length>0&&(u=u.concat(p)),u.push(s),u}},this.compare=function(t,e,n){var i=function(t,e,n,r){if(!(t.length>n))return e.length===n?0:-1;if(e.length===n)return 1;var o=t[n],s=e[n],a=r(o,s);return 1===a||-1===a?a:0===a?i(t,e,n+1,r):void 0};if(Array.isArray(t)&&Array.isArray(e)){var r="function"==typeof n?n:function(t,e){return t===e?0:t>e?1:-1};return i(t,e,0,r)}},this.commonAncestor=function(t,e){if(t instanceof Node&&e instanceof Node){if(this.contains(t,e))return t;if(this.contains(e,t))return e;for(var n=t.parentNode;n&&!this.contains(n,e);)n=n.parentNode;return n}},this.pathTo=function(t,e){if(t instanceof Node&&(e instanceof Node||void 0===e)){for(var n=void 0!==e,i=[],r=t;r.parentNode&&r!==e;)i.unshift(this.indexOf(r)),r=r.parentNode;return n&&e.parentNode&&!r.parentNode?void 0:i}}.bind(this),this.indexOf=function(t){if(!(t instanceof Node))throw new Error("The argument must be a Node instance!");for(var e=0,n=t.previousSibling;n;)e++,n=n.previousSibling;return e};var i=function(t,e,n){for(var i,r=[],o=t;!e.isEqualNode(o);)i=n(o),r=r.concat(i),o=o.parentNode;return r};this.bunchNextSiblings=function(t,e){return t instanceof Node&&e instanceof Node&&this.contains(e,t)?i(t,e,this.nextSiblings):void 0},this.bunchPrevSiblings=function(t,e){return t instanceof Node&&e instanceof Node&&this.contains(e,t)?i(t,e,this.prevSiblings):void 0};var r=function(t,e){for(var n=[],i=t[e];i;)n.push(i),i=i[e];return n};this.contains=function(t,e){if(!(t instanceof Node&&e instanceof Node))throw new Error("Both arguments must be Node instances!");for(var n=e;n;){if(n===t)return!0;n=n.parentNode}return!1},this.nextSiblings=function(t){return t instanceof Node?r(t,"nextSibling"):void 0},this.prevSiblings=function(t){return t instanceof Node?r(t,"previousSibling"):void 0},this.isTextNode=function(t){return t instanceof Node&&t.nodeType===Node.TEXT_NODE},this.detachBoundaries=function(t){if(!(t instanceof Range))throw new Error("The argument must be a Range instance!");if(t.collapsed)return[];var e=t.startContainer,n=t.endContainer,i=t.startOffset,r=t.endOffset,o=e===n,s=[];return this.isTextNode(e)?(o?this.spliceText(e,[i,r]):this.spliceText(e,[i]),s.push(e.nextSibling)):s.push(e.childNodes[i]),this.isTextNode(n)?o||(this.spliceText(n,[r]),s.push(n)):s.push(n.childNodes[r-1]),s},this.spliceText=function(t,e){if(t instanceof Text&&Array.isArray(e)){var n=e.length;if(0!==n)for(var i,r=0,o=0,s=t;n>r;)i=e[r]-o,i>0&&i<s.textContent.length&&(s=s.splitText(i)),o=e[r],r++}},this.nodesOfRange=function(t){if(!(t instanceof Range))throw new Error("The argument must be a Range instance!");if(t.collapsed)return[];var e=this.detachBoundaries(t);return 0===e.length?[]:1===e.length?[e[0]]:this.nodesBetween(e[0],e[1])},this.proxy=function(t){return t instanceof Node?t instanceof Element?t:t.nextSibling||t.previousSibling?t:t.parentNode:null},this.getInheritedStyleProp=function(t,e,n){if(void 0===e)throw new Error("Starting node must be defined!");var i,r=e,o=void 0===n||!n.contains(e);if(o)for(;r;){if("function"==typeof r.getAttribute&&(i=new Properties(r.getAttribute("style")),i.hasProperty(t)))return i.getProperty(t);r=r.parentNode}if(!o)for(;r&&n.contains(r);){if("function"==typeof r.getAttribute&&(i=new Properties(r.getAttribute("style")),i.hasProperty(t)))return i.getProperty(t);r=r.parentNode}},this.getMentor=function(t,e){for(var n,i=e;i;){if("function"==typeof i.getAttribute&&(n=new Properties(i.getAttribute("style")),n.hasProperty(t)))return i;i=i.parentNode}},this.getStyleProperty=function(t,e){if(t&&e&&"function"==typeof t.getAttribute){var n=new Properties(t.getAttribute("style"));if(n.hasProperty(e))return n.getProperty(e)}},this.dropStyleProperty=function(t,e){if(t instanceof Node&&"string"==typeof e&&t.style){t.style.removeProperty(e);var n="style",i=t.getAttribute(n);""===i&&t.removeAttribute(n)}},this.complementNodes=function(t,e){if(!t.contains(e))throw new Error("Start node must contain the end one!");if(t.isEqualNode(e))return[];var n,i,r=t.childNodes,o=r.length,s=[];for(n=0;o>n;n++)i=r[n],i.contains(e)?s=s.concat(this.complementNodes(i,e)):s.push(i);return s},this.insertAt=function(t,e,n){t instanceof Node&&(t.nodeType===Node.TEXT_NODE?this.insertIntoText(t,e,n):this.insertChild(t,e,n))},this.updateNode=function(t,e){console.log("updating ",t,"by template",e)},this.getAvailableWidth=function(t){var e="width",n=this.getMentor(e,t);return n?n.style[e]:void 0},this.insertChild=function(t,e,n){var i,r=t.childNodes;if(n>r.length)throw console.log(n,r.length),new Error("offset is too big!");if(n===r.length)t.appendChild(e);else{if(i=r[n],!i)throw new Error("Wrong offset to insert node at!");t.insertBefore(e,i)}},this.insertIntoText=function(t,e,n){if(e instanceof Text){var i,r=t.nodeValue,o=e.nodeValue;return i=r.slice(0,n)+o+r.slice(n),t.nodeValue=i,t}if(0===n)t.parentNode.insertBefore(e,t);else{var s,a;a=t.nodeValue.length,a>n&&(s=t.splitText(n),t.parentNode.insertBefore(e,s)),n===a&&(s=t.nextSibling,s?t.parentNode.insertBefore(e,s):t.parentNode.appendChild(e))}},this.selectionToList=function(t,e){Array.isArray(t)&&t.forEach(function(t){this.rangeToList(t,e)}.bind(this))},this.rangeToList=function(t,e){var n=this.getFactory();if(n){var i=new List(e),r=t.startContainer,o=t.startOffset,s=this.nodesOfRange(t),a=[];s&&s.forEach(function(t){try{var e=n.mimic(t);a.push(e),this.removeNode(t)}catch(i){console.log(i.name+" occurred when creating list item: "+i.message)}}.bind(this)),a.push(""),i.appendAsItems(a),this.insertAt(r,i.toNode(),o)}},this.setListNodeType=function(t,e){try{var n,i=this.getFactory().mimic(t);return i instanceof List?(i.switchName(e),n=t.parentNode,n.replaceChild(i.toNode(),t),!0):!1}catch(r){return console.log("Error ("+r.name+") when switching a list type: "+r.message),!1}},this.convertToBold=function(t){this.updateRangesStyleProp(t,"font-weight","bold")},this.convertToItalics=function(t){this.updateRangesStyleProp(t,"font-style","italic")},this.convertToStroked=function(t){this.updateRangesStyleProp(t,"text-decoration","line-through")},this.convertToUnderlined=function(t){this.updateRangesStyleProp(t,"text-decoration","underline")},this.updateRangesStyleProp=function(t,e,n){Array.isArray(t)&&t.forEach(function(t){this.modifyRangeStyleProperty(t,e,n)}.bind(this))},this.modifyRangeStyleProperty=function(t,e,n){var i;try{i=this.nodesOfRange(t)}catch(r){return void console.log("Error ("+r.name+") when retrieving nodes of the range: "+r.message)}this.accentuateNodesStyleProperty(i,e,n)},this.accentuateNodesStyleProperty=function(t,e,n){if(!Array.isArray(t))throw new Error("Set of nodes must be given as an array!");t.forEach(function(t){t instanceof Node&&this.accentuateSingleNodeStyleProperty(t,e,n)}.bind(this))},this.accentuateSingleNodeStyleProperty=function(t,e,n){var i=this.getMentor(e,t);if(i instanceof Element){var r=this.getStyleProperty(i,e);if(r===n)return;this.dropStyleProperty(i,e);var o=this.complementNodes(i,t);o.forEach(function(t){this.suggestStyleProperty(t,e,r)}.bind(this))}var s=this.proxy(t);this.setStyleProperty(s,e,n)},this.setStyleProperty=function(t,e,n){if(t instanceof Node&&"string"==typeof e&&""!==e&&("string"==typeof n||"number"==typeof n)&&""!==n){var i,r;if(t instanceof Element)i=t;else{var o=t.parentNode,s=document.createElement("span");o.insertBefore(s,t),s.appendChild(t),i=s}r=new Properties(i.getAttribute("style")),r.setMode(Properties.MODE_STYLE),r.setProperty(e,n),i.setAttribute("style",r.toString())}},this.suggestStyleProperty=function(t,e,n){if(!(t instanceof Node))throw new Error("It is illegal to suggest a property to a non-Node instance!");if(t.getAttribute){var i=t.getAttribute("style"),r=new Properties(i);if(r.hasProperty(e))return}this.setStyleProperty(t,e,n)},this.isImage=function(t){return t instanceof Element&&"img"===t.tagName.toLowerCase()},this.isLink=function(t){return t instanceof Element&&"a"===t.tagName.toLowerCase()},this.isTable=function(t){return t instanceof Element&&"table"===t.tagName.toLowerCase()},this.applyToDesOfManyRanges=function(t,e,n,i){t.forEach(function(t){t instanceof Range&&this.applyToDesOfSingleRange(t,e,n,i)}.bind(this))},this.clearRangesFromTables=function(t){this.applyToAncOfManyRanges(t,this.isTable,this.removeNode,!0)},this.applyToAncOfManyRanges=function(t,e,n){t.forEach(function(t){t instanceof Range&&this.applyToAncOfSingleRange(t,e,n)}.bind(this))},this.applyToAncOfSingleRange=function(t,e,n){var i=t.collapsed?[t.startContainer]:this.nodesOfRange(t),r=this.findAncestorsOfMany(i,e);r.forEach(function(t){try{n(t)}catch(e){return}}.bind(this))},this.deparentize=function(t){var e=t.parentNode;if(e){if(t instanceof Element){var n,i=t.childNodes.length;for(n=0;i>n;n++)e.insertBefore(t.childNodes[0],t)}this.removeNode(t)}},this.applyToDesOfSingleRange=function(t,e,n,i){var r=this.nodesOfRange(t);r.forEach(function(t){this.applyToDesOfSingleNode(t,e,n,i)}.bind(this))},this.applyToDesOfSingleNode=function(t,e,n,i){var r,o=void 0===i?!0:i;try{r=e(t)}catch(s){console.log("Error ("+s.name+") when applying criteria to a node: "+s.message),r=!1}if(r){try{n(t)}catch(s){console.log("Error ("+s.name+") when applying operation to a node: "+s.message)}if(o)return}var a,c=t.childNodes,f=c.length;for(a=f-1;a>=0;a--)this.applyToDesOfSingleNode(c.item(a),e,n,i)},this.removeNode=function(t){var e=t.parentNode;e&&e.removeChild(t)},this.insertColumn=function(t,e){console.log(t,e)},this.findSelectionFirstAncestor=function(t,e){var n,i,r=t.length;for(i=0;r>i;i++)if(n=this.findRangeFirstAncestor(t[i],e))return n},this.findRangeFirstAncestor=function(t,e){if(t.collapsed)return this.findAncestor(t.startContainer,e);var n,i,r=this.nodesOfRange(t),o=r.length;for(n=0;o>n;n++)if(i=this.findAncestor(r[n],e))return i},this.selectionToString=function(t,e){var n=[];return t.forEach(function(t){n.push(t.toString())}),n.join(e||"")},this.createFromTemplate=function(t){try{return this.getFactory().createFromTemplate(t)}catch(e){console.log(e.name+" occurred when delegating creation of a node from template: "+e.message)}},this.replaceChild=function(t,e){var n=e.parentNode;n&&n.replaceChild(t,e)},this.isNodeEditable=function(t){try{return t.nodeType===Node.TEXT_NODE||1===t.childNodes.length&&t.firstChild.nodeType===Node.TEXT_NODE}catch(e){return!1}},this.isSelectionEditable=function(t){return 1!==t.length?!1:this.isRangeEditable(t[0])},this.isRangeEditable=function(t){if(!(t instanceof Range))return!1;if(t.collapsed)return!0;var e=this.nodesOfRange(t);return e.length>1?!1:this.isNodeEditable(e[0])},this.modifyLink=function(t,e){var n,i,r=e.attributes,o=r.length;for(i=0;o>i;i++)n=r.item(i),n&&t.setAttribute(n.name,n.value);this.isNodeEditable(t)&&(t.innerHTML=e.innerHTML)},this.selectionToLink=function(t,e){console.log(t,e),t.forEach(function(t){this.rangeToLink(t,e)}.bind(this))},this.rangeToLink=function(t,e){t.collapsed&&this.insertAt(t.startContainer,e,t.startOffset);var n=this.nodesOfRange(t);console.log(n),n.forEach(function(t){this.nodeToLink(t,e)}.bind(this))},this.nodeToLink=function(t,e){console.log("nodeToLink",t,e);var n=t.parentNode;n&&(n.insertBefore(e,t),e.appendChild(t),this.clearNodeFromLink(t))},this.clearNodeFromLink=function(t){this.applyToDesOfSingleNode(t,this.isLink,this.deparentize,!0)},this.replaceSelectionByLink=function(t,e){var n=t[0];if(n.collapsed)return void this.insertAt(n.startContainer,e,n.startOffset);var i,r=this.nodesOfRange(n);r.length>0&&(i=r[0].parentNode,i&&i.replaceChild(e,r[0]))}}
function EditorAdapter(){var t="EditorAdapter";this.getName=function(){return t},this.setName=function(e){if("string"!=typeof e)throw new Error("The name must be a string!");t=e},this.getEditorContent=function(t){throw new Error('Method "getEditorContent" of class EditorAdapter must be overridden by inheriting class!')},this.setEditorContent=function(t,e){throw new Error('Method "setEditorContent" of class EditorAdapter must be overridden by inheriting class!')},this.toNativeRange=function(t){throw new Error('Method "toNativeRange" of class EditorAdapter must be overridden by inheriting class!')},this.getEditorRanges=function(t){throw new Error('Method "getEditorRanges" of class EditorAdapter must be overridden by inheriting class!')},this.getNativeRanges=function(t){var e;try{e=this.getEditorRanges(t)}catch(r){console.log("Error ("+r.name+") detected when retrieving editor ranges: "+r.message)}if(!Array.isArray(e))return null;var i=[];return e.forEach(function(t){try{var e=this.toNativeRange(t);i.push(e)}catch(r){console.log("Error ("+r.name+") detected when converting editor-specific range into native one: "+r.message)}}.bind(this)),i},this.fillInDialog=function(t,e,r){throw new Error('Method "fillInDialog" of class EditorAdapter must be overridden by inheriting class!')},this.getDialogData=function(t,e){throw new Error('Method "getDialogData" of class EditorAdapter must be overridden by inheriting class!')},this.getCursorPosition=function(t){throw new Error('Method "getCursorPosition" of class EditorAdapter must be overridden by inheriting class!')},this.setDialogInputField=function(t,e){throw new Error('Method "setDialogInputField" of class EditorAdapter must be overridden by inheriting class!')},this.setDialogHtmlField=function(t,e){throw new Error('Method "alert" of class EditorAdapter must be overridden by inheriting class!')},this.toNativeElement=function(t){throw new Error('Method "toNativeElement" of class EditorAdapter must be overridden by inheriting class!')},this.templateToDialog=function(t,e){throw new Error('Method "templateToDialog" of class EditorAdapter must be overridden by inheriting class!')},this.dialogToTemplate=function(t,e){throw new Error('Method "dialogToTemplate" of class EditorAdapter must be overridden by inheriting class!')},this.saveExtra=function(t,e){throw new Error('Method "saveExtra" of class EditorAdapter must be overridden by inheriting class!')},this.getExtra=function(t){throw new Error('Method "getExtra" of class EditorAdapter must be overridden by inheriting class!')},this.disableField=function(t,e){throw new Error('Method "disableField" of class EditorAdapter must be overridden by inheriting class!')},this.isFieldEnabled=function(t,e){throw new Error('Method "isFieldEnabled" of class EditorAdapter must be overridden by inheriting class!')},this.getFieldValue=function(t,e){throw new Error('Method "getFieldValue" of class EditorAdapter must be overridden by inheriting class!')}}
"use strict";var EHToolbar={registerEvent:function(e,r,t){var n=e.editable(),o=e.ui.get(t)._.id;n.attachListener(e.document,"mousedown",function(){return EHToolbar.highlight(e,r,o),!0}),n.attachListener(e.document,"keydown",function(t){return EHToolbar.isArrow(t)&&EHToolbar.highlight(e,r,o),!0})},highlight:function(e,r,t){return},isArrow:function(e){try{var r=parseInt(e.data.$.keyCode,10);return r>=37&&40>=r}catch(t){return console.log("Error ("+t.name+") is detected when deciding whether pressed key is an arrow one."),!1}}};
function Factory(e){"use strict";if(!(this instanceof Factory))return new Factory(e);var t=e instanceof Mapper?e:new Mapper;this.getMapping=function(){return t},this.setMapping=function(e){var n=e instanceof Mapper;return n&&(t=e),n};var n,a=[];this.setAvailableClasses=function(e){a=e},this.getAvailableClasses=function(){return a},this.setDefaultClass=function(e){n=e},this.getDefaultClass=function(){return n},this.stub=function(e){var t=this.getMapping();if(t){var n=t.findTargetFor(e);if("function"==typeof n)return new n}return null},this.mimic=function(e){var t=this.stub(e);return t&&"function"==typeof t.loadFromElement&&t.loadFromElement(e),t},this.createByTagName=function(e){console.log(this.getAvailableClasses());var t,n,a=this.getMapping();if(a){try{t=a.findTargetFor(e),console.log(e,t),n=new t}catch(r){return void console.log(r.name+" occurred when creating element by tag name: "+r.message)}return n}},this.findClass=function(e){var t,n,a,r=this.getAvailableClasses();for(t=r.length,n=0;t>n;n++){try{a=e(r[n])}catch(i){console.log(i.name+" occurred when applying the criteria to the class: "+i.message),a=!1}if(a)return r[n]}},this.findClassByName=function(e){if("string"==typeof e){var t=function(t){var n=new t;return"function"==typeof n.getName&&n.getName().toLowerCase()===e.toLowerCase()};return this.findClass(t)}},this.produceInstanceOf=function(e){if("function"==typeof e)try{return new e}catch(t){console.log(t.name+" occurred when producing a class instance: "+t.message)}},this.createFromTemplate=function(e){if("string"!=typeof e.name)return void 0;var t,n=this.findClassByName(e.name);if(n?t=this.produceInstanceOf(n):(t=this.produceInstanceOf(this.getDefaultClass()),t.setTag(e.name)),!t)return void 0;"function"==typeof t.loadTemplate&&t.loadTemplate(e);var a,r,i,s=e.children;if(Array.isArray(s)&&"function"==typeof t.appendElem)for(a=s.length,i=0;a>i;i++)r=this.createFromTemplate(s[i]),r&&t.appendElem(r);return t}}
var Helper={firstLetterUpperCase:function(r){return r.substring(0,1).toUpperCase()+r.substring(1)},onlyFirstLetterUpperCase:function(r){return r.substring(0,1).toUpperCase()+r.substring(1).toLowerCase()},sanitize:function(r){var t,e,n=[],i=r.length;for(t=0;i>t;t++)e=parseFloat(r[t]),n[t]=isNaN(e)?0:Math.abs(e);return n},trace:function(r){var t,e=0,n=r.length;for(t=0;n>t;t++)e+=r[t];return e},normalize:function(r){var t,e=this.trace(r),n=r.length,i=[],o=r.every(function(r){return 0===r});if(o&&(r=r.map(function(){return 1}),e=n),0===e)i=r;else for(t=0;n>t;t++)i[t]=r[t]/e;return i},splitWeighted:function(r,t){var e,n=this.normalize(this.sanitize(t)),i=[],o=n.length;for(e=0;o>e;e++)i[e]=r*n[e];return i},roundUp:function(r){return r.map(function(r){return Math.round(r)})},columnWidths:function(r,t){return this.roundUp(this.splitWeighted(r,t))},columnWidths2:function(r,t){var e=this.columnWidths(r,t),n=e.reduce(function(r,t){return r+t}),i=r-n,o=t.length;return 0!==i&&o>0&&(e[o-1]+=i),e},dropProtocol:function(r){var t="://",e="^[^"+t+"]+"+t,n=new RegExp(e,"gi");return r.replace(n,"")},fileExt:function(r){var t=".";return-1!==r.indexOf(t)?r.split(t).pop():""},validateWidth:function(r){"use strict";var t,e=!1,n={integer:["px","pt"],others:["em","%"]},i=parseFloat(r);return isNaN(i)?!1:(t=r.replace(i.toString(),"").trim(),-1!==n.integer.indexOf(t)&&(e=Math.floor(i).toString()+t),-1!==n.others.indexOf(t)&&(e=i.toString()+t),e)},specialChar:function(r){var t,e,n,i,o=typeof r,a="";if("function"===o||"object"===o)return null;if("number"===o)return r;for(t=r.length,e=0;t>e;e++)n=r.charCodeAt(e),i=n>31&&126>n?r[e]:"&#"+n+";",a+=i;return a},crack:function(r,t){var e,n,i,o,a,u,s,c=[],f=r.length;for(s=0;f>s;s++)c[s]=r[s];return 0===t&&(e=c[0],n=parseInt(e/2,10),i=e-n,u=0),t>0&&t<r.length&&(e=c[t],n=parseInt(2*e/3,10),i=e-n,o=r[t-1],a=parseInt(2*o/3,10),u=o-a,c[t-1]=a),c[t]=n,c.splice(t,0,i+u),c},sandwichWith:function(r,t,e){var n,i;return"string"==typeof t||"string"==typeof r?(i=e||r,n=t.trim(),n?r+n+i:""):void 0},concatDropSpaces:function(r,t){return void 0===t&&(t=" "),r.join(t).replace(/\s+/g," ").trim()},generateId:function(r,t){var e,n=new DOMParser,i=n.parseFromString(r,"text/html"),o="0123456789abcdefghijklmnopqrstuvwxyz",a=o.length;for(e=t||o.substr(Math.floor(Math.random()*(a+1)),1)+o.substr(Math.floor(Math.random()*(a+1)),1);i.getElementById(e);)e+=o.substr(Math.floor(Math.random()*(a+1)),1);return e},pushBeforeLast:function(r,t){if(void 0!==t)if(0===r.length)r.push(t);else{var e=r.pop();r.push(t),r.push(e)}},isSemanticallyValid:function(r){var t=new DOMParser,e=Helper.generateId(r,"fakeId"),n=t.parseFromString('<div id="'+e+'">'+r+"</div>","text/html"),i=n.getElementById(e);return i.innerHTML===r.trim()},cssOfSelector:function(r,t){var e=r+"\\s*\\{([^{}]+?)\\}",n=new RegExp(e,"gi"),i=t.match(n);if(!i)return"";var o=new Properties;return o.setMode(1),n=new RegExp(e,"i"),i.forEach(function(r){var t=r.match(n);t&&t[1]&&o.appendProperty(t[1])}),o.toString()},gcd:function(r,t){if("number"!=typeof t||"number"!=typeof r)throw new Error("Arguments must be numbers!");if(!this.isInteger(r)||!this.isInteger(t))return 1;if(0===r)return 0===t?1:t;if(0===t)return r;var e=Math.abs(r),n=Math.abs(t);if(n>e){var i=n;n=e,e=i}return this.gcd(n,e%n)},isInteger:function(r){return r===parseInt(r,10)},gcdList:function(r){if(!Array.isArray(r))throw new Error("Array is expected.");var t=r.map(function(r){return 0>r?-r:r}),e=t.length;if(1===e)return this.isInteger(t[0])&&t[0]>0?t[0]:1;if(2===e)return Helper.gcd(t[0],t[1]);if(e>2){var n=t.pop(),i=t.pop();return t.push(Helper.gcd(n,i)),Helper.gcdList(t)}},divideByGcd:function(r){var t;try{t=Helper.gcdList(r)}catch(e){return void console.log("There was an error "+e.message+" when finding gcd for ",r)}return 0===t?r:r.map(function(r){return r/t})}};Array.prototype.concatDropSpaces=function(r){return Helper.concatDropSpaces(this,r)};
function ImageProperties(e){"use strict";if(!(this instanceof ImageProperties))return new ImageProperties(e);Properties.call(this,e),this.setName("ImageProperties");var t={src:null,width:0,height:0,title:""};Object.keys(t).forEach(function(e){this.setProperty(e,t[e])}.bind(this));var i={"border-style":"none",width:0,padding:0,margin:0,height:0};this.initializeStyle();var r=this.getStyles();r.suggestProperty(i),this.setStyles(r)}ImageProperties.prototype=Object.create(Properties.prototype);
function ImageTag(){"use strict";if(!(this instanceof ImageTag))return new ImageTag;Tag.call(this);var t=["http","https"];this.setTag("img"),this.setName("ImageTag"),this.setProperties(new ImageProperties),this.setOrigin=function(e){var r=this.getProtocol(e);if(-1===t.indexOf(r))return void console.log("protocol "+r+" is not supported!");var i,s,o=document.createElement("img");o.src=e,i=o.width,s=o.height,"number"==typeof i&&i>0&&"number"==typeof s&&s>0&&(this.setProperty("src",e),this.setProperty("width",i),this.setWidth(i),this.setStyleProperty("height",s),this.setProperty("height",s))},this.dropProtocol=function(t){var e="://",r="^[^"+e+"]+"+e,i=new RegExp(r,"gi");return t.replace(i,"")},this.getProtocol=function(t){var e="://",r="^[^"+e+"]+"+e,i=new RegExp(r,"gi"),s=t.match(i);return Array.isArray(s)&&"string"==typeof s[0]?s[0].replace(e,""):null},this.getOrigin=function(){return this.getProperty("src")},this.getHeight=function(){return this.getProperty("height")||0},this.toHtml=function(){var t=this.getOrigin();return"string"==typeof t&&t.length>0?this.openingTag()+this.closingTag():""},this.template=function(){var t={name:"img",root:{src:this.getOrigin(),alt:this.getProperty("alt"),title:this.getProperty("title")}};return t},this.loadFromTemplate=function(t){var e;for(e in t)if(t.hasOwnProperty(e))switch(e){case"title":this.setProperty(e,t[e]);break;case"src":this.setOrigin(t[e]);break;case"alt":this.setProperty(e,t[e])}}}ImageTag.prototype=Object.create(Tag.prototype),ImageTag.prototype.characteristicFunction=function(t){return t instanceof Element&&"img"===t.tagName.toLowerCase()};
function Link(t){"use strict";return this instanceof Link?(Tag.call(this),this.setTag("a"),this.setName("Link"),this.setProperties(new LinkProperties),this.getHref=function(){return this.getProperty("href")},this.setHref=function(t){this.setProperty("href",encodeURI(t))},t&&"string"==typeof t&&this.setHref(t),this.underline=function(t){t===!0||void 0===t?this.setStyleProperty("text-decoration","underline"):t===!1?this.setStyleProperty("text-decoration","none"):"string"==typeof t&&this.setStyleProperty("text-decoration",t)},this.dropUnderline=function(){this.setStyleProperty("text-decoration","none")},this.apply=function(t){return t instanceof Link?this.updateLink(t):t instanceof Content?this.applyContent(t):t instanceof Tag?this.applyTag(t):this.wrap(t)},this.wrap=function(t){var e=new Link,n="function"==typeof t.clone?t.clone():t;return e.setProperties(this.getProperties().clone()),e.setStyles(this.getStyles().clone()),e.setElements([n]),e},this.applyTag=function(t){if(t instanceof Tag){var e,n,i;return t.getContent().isEmpty()?e=this.wrap(t):(e=t.clone(),n=e.getContent(),i=this.applyContent(n),e.setContent(i)),e}},this.applyContent=function(t){if(t instanceof Content){var e,n,i,r,s=new Content,o=t.getElements(),p=o.length;for(e=0;p>e;e++)n=o[e],r=this.clone(),i=r.apply(n),s.appendElem(i);return s}},this.updateLink=function(t){if(t instanceof Link){var e=new Link,n=this.getHref();return e.setElements(t.getElements()),e.setProperties(this.getProperties()),e.setStyles(this.getStyles()),e.appendStyle(t.getStyles()),e.appendProperties(t.getProperties()),e.setHref(n),e}},this.isUnderlined=function(){return"underline"===this.getStyleProperty("text-decoration")},this.template=function(){var t={name:"link",root:{href:this.getHref(),color:this.getStyleProperty("color"),isUnderlined:this.isUnderlined(),isTargetBlank:this.shouldOpenNew(),content:this.getContent().toText(),title:this.getProperty("title")}};return t},void(this.shouldOpenNew=function(){return"_blank"===this.getProperty("target")})):new Link(t)}Link.prototype=Object.create(Tag.prototype),Link.parseUri=function(t){if("string"!=typeof t||""===t)return{};var e=t.match(/^((\w+):(\/\/)?)?(.+?)(\/?)$/),n={};return e?(n.protocol=e[2]||"http",e[4]&&(n.href=e[4]),n):n},Link.prototype.characteristicFunction=function(t){return t instanceof Element&&"a"===t.tagName.toLowerCase()};
function LinkProperties(t){"use strict";if(!(this instanceof LinkProperties))return new LinkProperties(t);Properties.call(this,t),this.setName("LinkProperties");var e={href:"",target:"_blank",title:""};Object.keys(e).forEach(function(t){this.setProperty(t,e[t])}.bind(this));var i={"text-decoration":"underline","font-weight":"normal",padding:0,margin:0};this.initializeStyle();var r=this.getStyles();r.suggestProperty(i),this.setStyles(r)}LinkProperties.prototype=Object.create(Properties.prototype);
function List(t){"use strict";if(!(this instanceof List))return new List(t);Tag.call(this);var e=["ol","ul"];this.getAllowedTags=function(){return e.slice(0)},this.setTag(-1!==e.indexOf(t)?t:e[0]),this.setName("List"),this.setProperties(new ListProperties),this.switchName=function(t){-1!==e.indexOf(t)&&this.setTag(t)},this.itemNum=function(){return this.length()},this.appendItem=function(t){if(!(t instanceof ListItem))throw new Error("The argument is not a ListItem instance!");this.appendElem(t)},this.insertItemAt=function(t,e){if(!(e instanceof ListItem))throw new Error("The item to insert is not a ListItem instance!");this.insertElemAt(t,e)},this.appendList=function(t){var e,i;if(!(t instanceof List))throw new Error("The argument must be a List instance!");for(e=t.length(),i=0;e>i;i++)this.appendItem(t.getElem(i))},this.appendAsItems=function(t){if(void 0!==t){var e=Array.isArray(t)?t:[t],i=this.getElements();e.forEach(function(t){var e=new ListItem;e.appendElem(t),i.push(e)}),this.setElements(i)}}}List.prototype=Object.create(Tag.prototype),List.prototype.characteristicFunction=function(t){if(!(t instanceof Element))return!1;var e=t.tagName.toLowerCase();return"ul"===e||"ol"===e};
function ListItem(){"use strict";return this instanceof ListItem?(Tag.call(this),this.setTag("li"),this.setName("ListItem"),void this.setProperties(new ListItemProperties)):new ListItem}ListItem.prototype=Object.create(Tag.prototype),ListItem.prototype.characteristicFunction=function(t){return t instanceof Element&&"li"===t.tagName.toLowerCase()};
function ListItemProperties(t){"use strict";if(!(this instanceof ListItemProperties))return new ListItemProperties(t);Properties.call(this,t),this.setName("ListItemProperties");var e={padding:0,margin:0,"font-size":12,"font-weight":"normal",color:"#000001"};this.initializeStyle();var i=this.getStyles();i.suggestProperty(e),this.setStyles(i)}ListItemProperties.prototype=Object.create(Properties.prototype);
function ListProperties(t){"use strict";if(!(this instanceof ListProperties))return new ListProperties(t);Properties.call(this,t),this.setName("ListProperties");var e={padding:0,"margin-left":40,"margin-right":0,"margin-top":0,"margin-bottom":0};this.initializeStyle();var i=this.getStyles();i.suggestProperty(e),this.setStyles(i)}ListProperties.prototype=Object.create(Properties.prototype);
function Mapper(){"use strict";if(!(this instanceof Mapper))return new Mapper;var t=[],i=null;this.setDefaultTarget=function(t){"function"==typeof t&&(i=t)},this.getDefaultTarget=function(){return i},this.add=function(i,n){var e,r={};return void 0!==i&&(r.criterion=i),void 0!==n&&(r.target=n),e=this.isValidMapping(r),e&&t.push(r),e},this.getMappings=function(){return t.slice(0)},this.isValidMapping=function(t){return void 0!==t&&"function"==typeof t.criterion&&"function"==typeof t.target},this.flush=function(){t=[]},this.findTargetFor=function(t,i){var n,e,r=this.getMappings(),u=r.length,a=0;for(a=0;u>a;a++)if(n=r[a],e=n.criterion(t))return n.target;return i?void 0:this.getDefaultTarget()}}
function OList(){"use strict";return this instanceof OList?(List.call(this),this.setTag("ol"),void this.setName("OList")):new OList}OList.prototype=Object.create(List.prototype),OList.prototype.characteristicFunction=function(t){return t instanceof Element&&"ol"===t.tagName.toLowerCase()};
function PlainText(t){"use strict";if(!(this instanceof PlainText))return new PlainText(t);var n="PlainText",e="text";this.getTag=function(){return e},this.getName=function(){return n};var i="string"==typeof t||"number"==typeof t?t.toString():"";this.setContent=function(t){var n=typeof t;i="string"===n||"number"===n?t.toString():""},this.getContent=function(){return i.toString()},this.toHtml=function(){return this.getContent().toString()},this.loadFromElement=function(t){if(void 0===t||null===t)return!1;var n="string"==typeof t?t:t.textContent,e="string"==typeof n;return e&&this.setContent(n),e},this.isEmpty=function(){var t=this.getContent();return null===t||void 0===t||""===t},this.toNode=function(){return document.createTextNode(this.getContent())},this.clone=function(){var t,n,e,i=window[this.className],o=this.getContent();t="function"==typeof i?new i:new PlainText;for(n in this)this.hasOwnProperty(n)&&(e=this[n],t[n]=e&&"function"==typeof e.clone?e.clone():e);return t.setContent(o),t},this.toText=function(){return this.toHtml()}}
function Properties(t){"use strict";if(!(this instanceof Properties))return new Properties(t);var e={},r=["string","number"],i=["string","number","object"],o="Properties",s=0;this.setMode=function(t){if(1!==t&&0!==t)throw new Error("Allowed values for mode are 0, 1.");s=t},this.getMode=function(){return s},this.getName=function(){return o},this.setName=function(t){"string"==typeof t&&(o=t)},this.setStyles=function(t){e.style=t instanceof Properties?t:new Properties(t),e.style.setMode(Properties.MODE_STYLE)},this.setProperty=function(t,r){var i=typeof t,o=typeof r;return-1!==this.getAllowedKeyTypes().indexOf(i)&&-1!==this.getAllowedValueTypes().indexOf(o)?("style"===t?this.setStyles(r):e[t]=r,!0):!1},this.getAllowedKeyTypes=function(){return r},this.getAllowedValueTypes=function(){return i};var n=function(t,e){e=e||"-";var r=new RegExp("^(.*)-(.*$)"),i=t.match(r);return i?[i[1],i[2]]:void 0};this.getProperty=function(t){if("string"==typeof t||"number"==typeof t){if(e.hasOwnProperty(t))return e[t];var r=n(t,"-");return r?this.getPropertyBySide(r[0],r[1]):void 0}};var h=["top","right","bottom","left"];this.getAllowedSides=function(){return h},this.getPropertyBySide=function(t,e){var r=this.getAllowedSides().indexOf(e);if(-1!==r){var i=this.getProperty(t);if(i&&("string"==typeof i||"number"==typeof i))switch(i=i.toString().trim().split(/\s+/),i.length){case 1:return i[0];case 2:return i[r%2];case 3:return i[3>r?r:1];case 4:return i[r]}}},this.dropProperty=function(t){if(e.hasOwnProperty(t)){var r=e[t];return delete e[t],r}},this.dropAllProperties=function(){e={}},this.dropStyleProperty=function(t){if(this.hasStyleProperty(t)){var e=this.getStyles(),r=e.dropProperty(t);return this.setStyles(e),e=this.getStyles(),r}};var y=function(t,e){var r,i,o;"string"==typeof t?o=e.stringToJson(t):t instanceof Properties?o=t.getCore():"object"==typeof t&&(o=t);for(r in o)o.hasOwnProperty(r)&&(i=o[r],"object"==typeof e.getProperty(r)&&"object"==typeof i?e.appendToKey(r,i):e.setProperty(r,i))};this.appendToKey=function(t,e){var r=new Properties(this.getProperty(t));r.appendProperty(e),this.setProperty(t,r)},this.stringToJson=function(t){var e,r,i={},o=t.split(Properties.SEPARATOR_RECORDS);return o.forEach(function(t){var o=t.split(Properties.SEPARATOR_KEY_VALUE);2===o.length&&(r=o[0].trim(),e=o[1].trim(),i[r]=e)}),i},y(t,this),this.appendProperty=function(t){y(t,this)},this.appendStyle=function(t){this.initializeStyle(),this.getStyles().appendProperty(t)},this.initializeStyle=function(){var t="style";if(!this.getProperty(t)){var e=new Properties;e.setMode(Properties.MODE_STYLE),this.setProperty(t,e)}},this.toggleProperty=function(t,e,r){return void 0!==r?void this.setProperty(t,this.hasSet(t,[r])?r:e):this.hasSet(t)?void this.dropProperty(t):void this.setProperty(t,e)},this.hasSet=function(t,e){if(!this.hasProperty(t))return!1;var r=this.getProperty(t);return void 0!==e&&Array.isArray(e)?-1===e.indexOf(r):!0};var p=function(t){if(t instanceof Properties){var e,r,i,o=t.getCore();for(e in o)o.hasOwnProperty(e)&&(r=o[e],this.hasProperty(e)?(i=this.getProperty(e),r instanceof Properties&&i instanceof Properties&&i.suggestProperty(r)):this.setProperty(e,o[e]))}}.bind(this);this.suggestProperty=function(t){var e,r,i,o=typeof t,s=this;if(t instanceof Properties&&p(t),"string"===o&&(e=t.split(";"),e.forEach(function(t){var e=t.split(":");2===e.length&&(r=e[0].trim(),i=e[1].trim(),s.hasProperty(r)||s.setProperty(r,i))})),"object"===o)for(r in t)t.hasOwnProperty(r)&&(s.hasProperty(r)||s.setProperty(r,t[r]))},this.hasProperty=function(t){var e=this.getCore();return e&&"function"==typeof e.hasOwnProperty&&e.hasOwnProperty(t)},this.propNum=function(){return Object.keys(e).length},this.getCore=function(){var t,r={};for(t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r},this.isTheSameAs=function(t){if(!(t instanceof Properties))return!1;var e=this.getCore(),r=t.getCore(),i=this.propNum(),o=t.propNum();if(i!==o)return!1;var s=Object.keys(e);return s.every(function(t){return e[t]===r[t]})},this.clone=function(){var t,e,r,i=window[this.getName()],o=this.getCore();t="function"==typeof i?new i:new Properties;for(e in this)this.hasOwnProperty(e)&&(r=this[e],t[e]=r&&"function"==typeof r.clone?r.clone():r);for(e in o)o.hasOwnProperty(e)&&t.setProperty(e,o[e]);return t},this.isEmpty=function(){var t=this.getCore();return!t||0===Object.keys(t).length},this.toString=function(){var t,r,i=[],o=Object.keys(e),s=this.getMode();return t=1===s?": ":'="',r=1===s?";":'"',o.forEach(function(o){var n,h,y=e[o];if(null!==y)switch(h=typeof y){case"object":"function"==typeof y.toString&&(n=y.toString());break;case"number":n=y.toString()+(1===s?"px":"");break;default:n=y}"string"==typeof n&&n.length>0&&i.push(o.toString()+t+n+r)}),i.join(" ")},this.load=function(t){var e,r,i,o,s=t.length;for(e=0;s>e;e++)r=t[e].nodeName.trim(),i=t[e].nodeValue.trim(),o=parseFloat(i),o.toString()===i&&(i=o),this.setProperty(r,i);return!0},this.hasStyles=function(){return this.hasProperty("style")},this.getStyles=function(){return this.getProperty("style")},this.hasStyleProperty=function(t){return this.hasStyles()&&this.getStyles().hasProperty(t)},this.setStyleProperty=function(t,e){this.initializeStyle(),this.getStyles().setProperty(t,e)},this.getStyleProperty=function(t){return this.hasStyles()?this.getStyles().getProperty(t):void 0},this.getBorderInfo=function(){var t={};return t.width=this.getProperty("border-width")||0,t.style=this.getProperty("border-style")||"none",this.hasProperty("border-color")&&(t.color=this.getProperty("border-color")),t},this.decorateElement=function(t){if("function"==typeof t.setAttribute){var e=this.getCore(),r=Object.keys(e);r.forEach(function(r){t.setAttribute(r,e[r])})}},this.setWidth=function(t){this.initializeStyle(),this.setProperty("width",t),this.setStyleProperty("width",t)},this.getWidth=function(){var t="width";return this.hasStyleProperty(t)?this.getStyleProperty(t):this.hasProperty(t)?this.getProperty(t):void 0},this.loadNodeProperties=function(t){var e=t.attributes;e&&this.load(e)},this.setBorder=function(t){var e,r,i,o=1,s="#000001",n="solid";void 0===t&&(t={width:o,color:s,style:n}),e=t.width||o,r=t.color||s,i=t.style||n,this.setStyleProperty("border-width",e),this.setStyleProperty("border-color",r),this.setStyleProperty("border-style",i),this.setProperty("border",e)},this.getBorder=function(){var t={},e="border-style",r="border-width",i="border-color";return t.style=this.hasStyleProperty(e)?this.getStyleProperty(e):"none","none"!==t.style&&(t.width=this.hasStyleProperty(r)?this.getStyleProperty(r):0,0!==t.width&&this.hasStyleProperty(i)&&(t.color=this.getStyleProperty(i))),t},this.removeBorder=function(){this.hasStyleProperty("border-width")&&this.dropStyleProperty("border-width"),this.hasStyleProperty("border-color")&&this.dropStyleProperty("border-color"),this.setStyleProperty("border-style","none"),this.hasProperty("border")&&this.dropProperty("border")},this.shrinkBy=function(t){if(void 0!==t&&this.hasProperty("width")){var e=new Unit(this.getWidth());if("number"==typeof t){var r=e.getValue()-t;return void this.setWidth(r)}if("string"==typeof t){var i,o=new Unit(t);try{i=e.sub(o)}catch(s){throw new Error("Can not shrink: units of measurement do not coincide.")}this.setWidth(i.getValue())}}},this.template=function(){var t,e,r,i,o,s=["string","number"],n=this.getCore(),h={};if("object"!=typeof n)return h;for(t=Object.keys(n),o=t.length,i=0;o>i;i++)e=n[t[i]],-1!==s.indexOf(typeof e)?h[t[i]]=e:e instanceof Properties&&(r=e.template(),Object.keys(r).length>0&&(h[t[i]]=r));return h}}Object.defineProperty(Properties,"MODE_ATTRIBUTE",{value:0,writable:!1}),Object.defineProperty(Properties,"MODE_STYLE",{value:1,writable:!1}),Object.defineProperty(Properties,"SEPARATOR_RECORDS",{value:";",writable:!1}),Object.defineProperty(Properties,"SEPARATOR_KEY_VALUE",{value:":",writable:!1});
function Row(){"use strict";return this instanceof Row?(Tag.call(this),this.setTag("tr"),this.setName("Row"),this.setProperties(new RowProperties),this.getCellWidths=function(){var t,e=[],i=this.cellNum();for(t=0;i>t;t++)e.push(this.getElem(t).getWidthValue());return e},this.cellNum=function(){return this.length()},this.setCellWidths=function(t){var e,i=t.length;if(this.cellNum()!==i)throw new Error("Incompatible array length!");for(e=0;i>e;e++)this.getElem(e).setWidth(t[e])},this.insertCellAt=function(t,e){if(!(e instanceof Cell))throw new Error("Only a Cell instance is allowed for insertion!");this.insertElemAt(t,e)},this.appendCell=function(t){if(!(t instanceof Cell))throw new Error("The argument is not a Cell instance!");this.appendElem(t)},this.onlyTableInside=function(){var t=this.getFirst();return void 0===t||1!==this.cellNum()||1!==t.length()?!1:t.getFirst()instanceof Table},this.dropCellAt=function(t){this.dropElemAt(t)},this.knockOutCell=function(t){var e,i,n,s,r,l,o;t<this.cellNum()&&(this.getElem(t+1)?e=this.getElem(t+1):this.getElem(t-1)&&(e=this.getElem(t-1)),e&&(i=e.getWidth(),n=this.getElem(t),s=n.getWidth(),l=new Unit(i),o=new Unit(s),r=l.add(o),e.setWidth(r.getValue())),this.dropElemAt(t))},this.appendStyleToCellAt=function(t,e){this.appendStyleToElemAt(t,e)},this.phantomCellStyles=function(){return this.getPhantomCellProp("style")},this.phantomCellAttr=function(){return this.getPhantomCellProp("attr")},this.getPhantomCellProp=function(t){if(this.onlyTableInside()){if("style"===t)return this.getFirst().getStyles();if("attr"===t)return this.getFirst().getProperties()}},this.getPhantomTableProp=function(t){if(this.onlyTableInside()){if("style"===t)return this.getFirst().getFirst().getStyles();if("attr"===t)return this.getFirst().getFirst().getProperties()}},this.phantomTableStyles=function(){return this.getPhantomTableProp("style")},this.phantomTableAttr=function(){return this.getPhantomTableProp("attr")},this.makeShape=function(t,e){if(void 0===t)throw new Error("Number of cells is missing.");if(parseInt(t,10)!==t||0>=t)throw new Error("Number of cells must be positive integer.");var i="function"==typeof e;this.flushContent();var n,s;for(n=0;t>n;n++)s=new Cell,i&&s.setContent(e(n)),this.appendCell(s)},void(this.setCellTopBorder=function(t){var e,i,n=new Content,s=this.cellNum();for(e=0;s>e;e++)i=this.getElem(e),i.setStyleProperty("border-top",t),n.appendElem(i);this.setContent(n)})):new Row}Row.prototype=Object.create(Tag.prototype),Row.prototype.characteristicFunction=function(t){return t instanceof Element&&"tr"===t.tagName.toLowerCase()};
function RowProperties(e){"use strict";if(!(this instanceof RowProperties))return new RowProperties(e);Properties.call(this,e),this.setName("RowProperties");var t={"border-style":"none",width:0,padding:0,margin:0};this.initializeStyle();var r=this.getStyles();r.suggestProperty(t),this.setStyles(r)}RowProperties.prototype=Object.create(Properties.prototype);
function Table(){"use strict";if(!(this instanceof Table))return new Table;Tag.call(this),this.setTag("table"),this.setName("Table"),this.setProperties(new TableProperties);var t,e,r;this.initPhantoms=function(){e instanceof Row||(e=new Row),t instanceof Cell||(t=new Cell),r instanceof Table||(r=new Table)},this.getPhantomCellStyles=function(){return t instanceof Cell?t.getStyles():void 0},this.setPhantomCellStyles=function(e){void 0!==e&&(this.initPhantoms(),t.setStyles(e instanceof Properties?e:new Properties(e)))},this.getPhantomRowStyles=function(){return e instanceof Row?e.getStyles():void 0},this.setPhantomRowStyles=function(t){void 0!==t&&(this.initPhantoms(),e.setStyles(t instanceof Properties?t:new Properties(t)))},this.getPhantomTableStyles=function(){return r instanceof Table?r.getStyles():void 0},this.setPhantomTableStyles=function(t){void 0!==t&&(this.initPhantoms(),r.setStyles(t instanceof Properties?t:new Properties(t)))},this.getPhantomCellAttributes=function(){return t instanceof Cell?t.getProperties():void 0},this.setPhantomCellAttributes=function(e){this.initPhantoms(),t.setProperties(e)},this.getPhantomRowAttributes=function(){return e instanceof Row?e.getProperties():void 0},this.setPhantomRowProperties=function(t){this.initPhantoms(),e.setProperties(t)},this.setPhantomCellProperties=function(e){this.initPhantoms(),t.setProperties(e)},this.getPhantomTableAttributes=function(){return r instanceof Table?r.getProperties():void 0},this.setPhantomTableProperties=function(t){this.initPhantoms(),r.setProperties(t)},this.getPhantomTableProperties=function(){return this.initPhantoms(),r.getProperties()},this.getPhantomCellProperties=function(){return t.getProperties()},this.getPhantomRowProperties=function(){return e.getProperties()},this.getPhantomTag=function(o,i){if("string"==typeof o){var n=o.toLowerCase(),s="string"==typeof i&&"close"===i.toLowerCase()?"closingTag":"openingTag";if("cell"===n&&void 0!==t&&"function"==typeof t[s])return t[s]();if("row"===n&&void 0!==e&&"function"==typeof e[s])return e[s]();if("table"===n&&void 0!==r&&"function"==typeof r[s])return r[s]()}},this.rowNum=function(){var t=this.getBody();return t?t.length:0},this.setBody=function(t){var e,r=Array.isArray(t)?t:[t];if(e=r.every(function(t){return t instanceof Row}),!e)throw new Error("Instance of Row class is required to be set as tbody!");var o=this.getContent(),i=o.findTagPos("tbody"),n=new Tag("tbody");n.setElements(r),i.length>0&&(i.sort(function(t,e){return e-t}),i.forEach(function(t){o.dropElemAt(t)})),o.appendElem(n),this.setContent(o)},this.setElements=function(t){this.setBody(t)},this.getBody=function(){var t=this.getContent(),e=t.getFirstEntryOfTag("tbody");return e?e.getElements():[]},this.getFooter=function(){var t=this.getContent();return t?t.getFirstEntryOfTag("tfoot"):void 0},this.getHeader=function(){var t=this.getContent();return t?t.getFirstEntryOfTag("thead"):void 0},this.getCaption=function(){var t=this.getContent();return t?t.getFirstEntryOfTag("caption"):void 0},this.appendRow=function(t){if(!(t instanceof Row))throw new Error("The argument is not a Row instance!");var e=this.getContent(),r=e.getFirstEntryOfTag("tbody");r?r.appendElem(t):(r=new Tag("tbody"),r.setElements([t]),e.appendElem(r)),this.setContent(e)},this.getMatrix=function(){var t,e=[],r=this.rowNum(),o=this.getBody();for(t=0;r>t;t++)e.push(o[t].getCellWidths());return e},this.getProfile=function(){var t=this.isSameWidths()?this.getMatrix()[0]:null;return t},this.setProfile=function(t){var e,r=this.rowNum(),o=this.colNum();if(!Array.isArray(t))throw new Error("Wrong argument type: array expected.");if(t.length!==o)throw new Error("Wrong input array length!");var i=this.getBody();for(e=0;r>e;e++)i[e].setCellWidths(t);this.setBody(i)},this.insertColAt=function(t,e){e=e||new Cell;var r,o=this.colNum(),i=this.rowNum(),n=this.getBody();if(0>=o||0>t||t>o)throw new Error("Wrong index for the cell to insert!");if(o>t)for(r=0;i>r;r++)n[r].insertCellAt(t,e);else for(r=0;i>r;r++)n[r].appendCell(e);return this.setBody(n),null},this.knockOutCol=function(t){var e,r=this.rowNum(),o=this.getBody();for(e=0;r>e;e++)o[e].knockOutCell(t);this.setBody(o)},this.dropColAt=function(t){var e,r=this.rowNum(),o=this.getBody();for(e=0;r>e;e++)o[e].dropCellAt(t);this.setBody(o)},this.colNum=function(){var t,e,r,o=this.rowNum();if(0===o)return 0;if(r=this.getBody(),t=r[0].cellNum(),1===o)return t;for(e=1;o>e;e++)if(r[e].cellNum()!==t)return null;return t},this.isSameWidths=function(){var t,e,r,o,i=this.getMatrix(),n=i.length,s=!0;if(n>1)for(t=i[0],e=t.length,r=1;n>r;r++){if(i[r].length!==e){s=!1;break}for(o=0;e>o;o++)if(i[r][o]!==t[o]){s=!1;break}if(!s)break}return s},this.setBorder=function(t){var e=this.getProperties();e.setBorder(t),this.setProperties(e)},this.getBorder=function(){return this.getProperties().getBorder()},this.removeBorder=function(){var t=this.getProperties();t.removeBorder(),this.setProperties(t)},this.isFragmented=function(){return 0===this.rowNum()?!1:this.getBody().every(function(t){var e=t.onlyTableInside();return e})},this.isFramed=function(){return void 0!==e||void 0!==t||void 0!==r},this.unsetPhantom=function(){e=void 0,t=void 0,r=void 0},this.appendStyleToCol=function(t,e){var r,o=parseInt(t,10),i=this.colNum(),n=this.rowNum(),s=this.getBody();if(!(o===t&&t>=0&&i>t))throw new Error("The column is not present!");for(r=0;n>r;r++)s[r].appendStyleToCellAt(t,e);this.setBody(s)},this.bodyToHtml=function(){var t="",e="",r="";return this.isFramed()&&(e=this.getPhantomTag("row","open")+this.getPhantomTag("cell","open")+this.getPhantomTag("table","open"),t=this.getPhantomTag("table","close")+this.getPhantomTag("cell","close")+this.getPhantomTag("row","close")),this.getBody().forEach(function(o){"function"==typeof o.toHtml&&(r+=e+o.toHtml()+t)}),r},this.toHtml=function(){var t=this.openingTag(),e=this;return this.getElements().forEach(function(r){"function"==typeof r.toHtml&&(t+="tbody"===r.getTag()?r.openingTag()+e.bodyToHtml()+r.closingTag():r.toHtml())}),t+=this.closingTag()},this.toNode=function(){var o=document.createElement(this.getTag());if(this.getProperties().decorateElement(o),this.isFramed()){var i=this.getBody();i.forEach(function(i){var n=i.toNode(),s=e.toNode(),l=t.toNode(),a=r.toNode();s.appendChild(l),l.appendChild(a),a.appendChild(n),o.appendChild(s)})}else this.getContent().stickTo(o);return o},this.getPhantomRowProp=function(t){if(!this.isFragmented())return null;var e,r,o,i=this.getFirst(),n=this.rowNum();switch(t){case"attr":o=i.getProperties();break;case"style":o=i.getStyles();break;default:return null}if(1===n)return o;if("function"!=typeof o.isTheSameAs)return null;for(r=1;n>r;r++)if(e="style"===t?this.getElem(r).getStyles():"attr"===t?this.getElem(r).getProperties():null,!o.isTheSameAs(e))return null;return o},this.getRow=function(t){if(void 0!==t){var e=this.rowNum();if(e>0&&t>=0&&e>t)return this.getBody()[t]}},this.getFirstRow=function(){return this.rowNum()>0?this.getBody()[0]:void 0},this.getLastRow=function(){var t=this.rowNum();return t>0?this.getBody()[t-1]:void 0},this.getPhantomCellProp=function(t){if(!this.isFragmented())return null;var e,r,o,i=this.rowNum(),n=this.getFirst();if(e=n.getPhantomCellProp(t),1===i)return e;for(r=1;i>r;r++)if(o=this.getElem(r).getPhantomCellProp(t),!e.isTheSameAs(o))return null;return e},this.getPhantomTableProp=function(t){if(!this.isFragmented())return null;var e,r,o,i=this.rowNum(),n=this.getFirst();if(e=n.getPhantomTableProp(t),1===i)return e;for(r=1;i>r;r++)if(o=this.getElem(r).getPhantomTableProp(t),!e.isTheSameAs(o))return null;return e},this.disentangle=function(){if(!this.isFragmented())return null;var t,e,r,o,i,n=[],s=this.rowNum();if(i=this.getBody(),e=this.getFirstRow(),e&&(this.setPhantomRowProperties(e.getProperties()),r=e.getFirst(),r&&(this.setPhantomCellProperties(r.getProperties()),o=r.getFirst()))){for(this.setPhantomTableProperties(o.getProperties()),t=0;s>t;t++)try{n.push(i[t].getFirst().getFirst().getFirstRow())}catch(l){console.log("Error ("+l.name+") when retrieving nested rows "+l.message)}try{this.setBody(n)}catch(l){console.log("Error ("+l.name+") when setting table body "+l.message)}}},this.makeShape=function(t,e,r){if(void 0===t)throw new Error("Number of rows and columns are missing.");if(parseInt(t,10)!==t||0>=t)throw new Error("Number of rows must be positive integer.");var o,i,n,s="function"==typeof r;for(this.flushContent(),o=0;t>o;o++)i=new Row,s?(n=function(t){return r(o,t)},i.makeShape(e,n)):i.makeShape(e),this.appendRow(i)},this.markRows=function(t){var e,r,o=this.rowNum(),i=new Content;for(e=0;o>e;e++)r=this.getElem(e),r&&"function"==typeof r.mark&&(r.mark(t),i.appendElem(r));this.setContent(i)},this.configureProperties=function(t){console.log("configuring properties: ",t);var e,r,o=t.width,i=t.tableBorderWidth,n=t["border-spacing"],s=o.clone(),l=n.frac(2,0);t.margin.getValue()>0&&(this.setStyleProperty("margin",t.margin.toString()),s=s.sub(t.margin.times(2)));var a=t.padding;if(this.setStyleProperty("padding",a.toString()),this.setProperty("cellspacing",a.getValue()),s=s.sub(a.times(2)),i.getValue()>0&&(s=s.sub(i.times(2)),this.setBorder({style:"solid",color:t.tableBorderColor,width:i.getValue()})),this.setWidth(s.getValue()),this.setStyleProperty("border-spacing","0px "+l.toString()),t.globalTableBgColor&&this.setStyleProperty("background-color",t.globalTableBgColor),t.phantomBorderWidth.getValue()>0){var h=new RowProperties,u=new CellProperties,g=new TableProperties;h.setStyleProperty("padding",0),h.setStyleProperty("margin",0),u.setStyleProperty("padding",0),u.setStyleProperty("margin",0),h.setWidth(s.getValue()),u.setWidth(s.getValue()),g.setBorder({style:"solid",color:t.phantomBorderColor,width:t.phantomBorderWidth.getValue()}),s=s.sub(t.phantomBorderWidth.times(2)),g.setWidth(s.getValue()),this.setPhantomRowProperties(h),this.setPhantomCellProperties(u),this.setPhantomTableProperties(g)}this.setAllRowWidths(s.getValue()),e=Helper.columnWidths2(s.getValue(),t.cellWeights);var f=t.cellBorderWidth.toString()+" solid "+t.cellBorderColor;if(t.cellBorders.topHor&&this.setStylePropertyOfBlock("border-top",f,[0]),t.cellBorders.bottomHor&&t.rows>0&&this.setStylePropertyOfBlock("border-bottom",f,[t.rows-1]),t.cellBorders.intHor){var d=[];for(r=1;r<t.rows;r++)d.push(r);this.setStylePropertyOfBlock("border-top",f,d)}if(t.cellBorders.leftVer&&(this.setStylePropertyOfBlock("border-left",f,null,[0]),e[0]-=t.cellBorderWidth.getValue()),t.cellBorders.rightVer&&(this.setStylePropertyOfBlock("border-right",f,null,[t.cols-1]),e[e.length-1]-=t.cellBorderWidth.getValue()),t.cellBorders.intVer){var c=[];for(r=1;r<t.cols;r++)c.push(r),e[r]-=t.cellBorderWidth.getValue();this.setStylePropertyOfBlock("border-left",f,null,c)}this.setStylePropertyOfBlock("padding",t["cell[padding]"].toString(),null,null),this.setProfile(e)},this.setStylePropertyOfBlock=function(t,e,r,o){if(!Array.isArray(r)&&null!==r&&void 0!==r)throw new Error("Row range must be an array!");var i,n,s=this.getBody(),l=[],a=s.length,h=null===r||void 0===r;for(n=0;a>n;n++)i=s[n],(h||-1!==r.indexOf(n))&&i.setStylePropertyOfRange(t,e,o),l.push(i);this.setBody(l)},this.setAllRowWidths=function(t){if("string"!=typeof t&&"number"!=typeof t)throw new Error("Width must be a string or a number!");var e,r,o=this.getBody(),i=[],n=o.length;for(r=0;n>r;r++)e=o[r],e.setWidth(t),i.push(e);this.setBody(i)},this.getStylePropertyOfBlock=function(t,e,r){if(!Array.isArray(e)&&null!==e&&void 0!==e)throw new Error("Row range must be an array!");var o,i,n,s,l=this.getBody(),a=l.length,h=null===e||void 0===e;for(h||(e=e.map(function(t){return 0>t?a+t:t})),i=0;a>i;i++)if(h||-1!==e.indexOf(i))if(o=l[i],s=o.getStylePropertyOfRange(t,r),void 0===n)n=s;else if(n!==s)return;return n},this.update=function(t){var e=this.clone();return e.configureProperties(t),e},this.getStylePropertyOfRangeAsBorderInfo=function(t,e,r){var o=this.getStylePropertyOfBlock(t,e,r),i={style:"none"};if(o){o=o.trim();var n=new RegExp(/\s+/g),s=o.split(n);if(s.length>=3){var l=s.shift(),a=s.shift();0===parseInt(l,10)?i.style="none":(i.style=a,i.width=l,i.color=s.join(" "))}}return i};var o=function(t,e){var r=0,o=[];for(r=0;e>r;r++)o[r]=t+r;return o};this.getCellBorders=function(){var t,e,r,i,n={},s=o(1,this.rowNum()-1),l=o(1,this.colNum()-1),a={topHor:["border-top",[0]],bottomHor:["border-bottom",[-1]],intHor:["border-top",s],leftVer:["border-left",null,[0]],rightVer:["border-right",null,[-1]],intVer:["border-left",null,l]};for(i in a)a.hasOwnProperty(i)&&(e=a[i],r=this.getStylePropertyOfRangeAsBorderInfo(e[0],e[1],e[2]),n[i]="none"!==r.style,void 0===t&&n[i]&&(t=parseInt(r.width,10),n.width=t,n.color=r.color));return n},this.getPhantomTableBorder=function(){var t={style:"none"},e=this.getPhantomTableProperties();return e&&(t=e.getBorder()),t},this.extractPhantomTemplate=function(t){var e="frame";return t&&t.hasOwnProperty(e)?t[e]:void 0},this.loadTemplate=function(t){var e=this.extractProperTemplate(t),r=this.extractPhantomTemplate(t);e.hasOwnProperty("border-width")&&(e["border-style"]="solid"),this.setProperties(e),this.setWidth(e.width),r&&(r.width=e.width,this.setPhantomTemplate(r));var o,i,n=parseInt(t.rows,10),s=t.row;if("number"==typeof n){for(s.cell=t.cell,console.log(s),o=0;n>o;o++)i=new Row,0===o&&s&&s["border-first"]&&i.setStyleProperty("border-top",s.root.style["border-width"]+"px solid "+s.root.style["border-color"]),o===n-1&&t.row["border-last"]&&console.log("create border of the last row"),o>0&&n-1>o&&t.row["border-middle"]&&console.log("create border of the middle row"),console.log("loading row template:",s),i.loadTemplate(s),this.appendRow(i);console.log("rows: "+t.rows,", columns: "+t.columns)}},this.setPhantomTemplate=function(t){var e=new Properties(t);e.setMode(Properties.MODE_STYLE),this.setPhantomTableProperties(e),this.setPhantomRowProperties(e),this.setPhantomCellProperties(e)}}Table.prototype=Object.create(Tag.prototype),Table.prototype.characteristicFunction=function(t){return t instanceof Element&&"table"===t.tagName.toLowerCase()};
function TableProperties(e){"use strict";if(!(this instanceof TableProperties))return new TableProperties(e);Properties.call(this,e),this.setName("TableProperties");var t={cellpadding:0,cellspacing:0};Object.keys(t).forEach(function(e){this.setProperty(e,t[e])}.bind(this));var i={"border-style":"none",padding:0,margin:0,width:0,"border-spacing":"0px 0px","font-size":13,"text-align":"justify","font-family":"Arial, sans-serif"};this.initializeStyle();var r=this.getStyles();r.suggestProperty(i),this.setStyles(r)}TableProperties.prototype=Object.create(Properties.prototype);
function Tag(t){"use strict";if(!(this instanceof Tag))return new Tag;var e=t||null,n="Tag";this.getTag=function(){return e},this.setTag=function(t){if(void 0!==t){var n=typeof t;"string"===n?e=t:"number"===n&&(e=t.toString())}};var r=new Properties,i=new Content,o=null,s=new Unit;this.setUnitWorker=function(t){t&&(s=t)},this.getUnitWorker=function(){return s},this.getMarker=function(){return o},this.setMarker=function(t){"string"==typeof t&&""!==t&&(o=t)},this.setProperties=function(t){r=t instanceof Properties?t.clone():new Properties(t)},this.getProperties=function(){var t=r.clone();return t},this.setStyles=function(t){r.setStyles(t)},this.getStyles=function(){return r.getStyles()},this.setContent=function(t){i=t instanceof Content?t:new Content(t)},this.getContent=function(){return i.clone()},this.getName=function(){return n},this.setName=function(t){"string"==typeof t&&(n=t)},this.appendStyle=function(t){r.appendStyle(t)},this.appendAttributes=function(t){console.log("This method is deprecated. Redirected to appendProperties()"),r.appendProperties(t)},this.appendProperties=function(t){r.appendProperty(t)},this.appendStyleToElemAt=function(t,e){i.appendStyleToElemAt(t,e)},this.getStyleProperty=function(t){var e=this.getStyles();return e?e.getProperty(t):void 0},this.setStyleProperty=function(t,e){return r.setStyleProperty(t,e)},this.getProperty=function(t){return this.getProperties().getProperty(t)},this.setProperty=function(t,e){r.setProperty(t,e)},this.hasProperty=function(t){var e=this.getProperties();return e&&e.hasProperty(t)},this.hasStyleProperty=function(t){var e=this.getStyles();return void 0!==e&&null!==e&&e.hasProperty(t)},this.dropProperty=function(t){return this.hasProperty(t)?r.dropProperty(t):void 0},this.dropStyleProperty=function(t){return this.hasStyleProperty(t)?this.getStyles().dropProperty(t):void 0},this.setWidth=function(t){void 0!==t&&r.setWidth(t)},this.getWidth=function(){var t=this.getProperties();return t?t.getWidth():void 0},this.getWidthValue=function(){var t=this.getWidth();if(void 0!==t){var e=parseFloat(t);if(!isNaN(e))return e}},this.getElements=function(){var t=this.getContent();return t?t.getElements():void 0},this.setElements=function(t){Array.isArray(t)&&i.setElements(t)},this.getElem=function(t){return this.getContent().getElem(t)},this.getFirst=function(){return this.getContent().getFirst()},this.getLast=function(){return this.getContent().getLast()},this.insertElemAt=function(t,e){i.insertElemAt(t,e)},this.appendElem=function(t){i.appendElem(t)},this.length=function(){return this.getContent().length()},this.dropElemAt=function(t){return i.dropElemAt(t)},this.dropFirst=function(){i.dropFirst()},this.dropLast=function(){i.dropLast()},this.openingTag=function(){var t,e=this.getTag();return"string"==typeof e&&e.length>0?(t=this.getProperties(),t=t&&"function"==typeof t.toString?t.toString():"",t.length>0&&(t=" "+t),"<"+e+t+">"):void 0},this.closingTag=function(){var t=this.getTag();return"string"==typeof t&&t.length>0?"</"+t+">":void 0},this.toHtml=function(){var t,e=this.getTag(),n=this.openingTag(),r=this.closingTag(),i=this.getContent().toHtml();return t="string"==typeof e&&e.length>0?n+i+r:"<!-- tag name is missing -->"},this.toText=function(){return this.getContent().toText()},this.isEmpty=function(){return this.getProperties().isEmpty()&&this.getContent().isEmpty()},this.flushContent=function(){i.flush()},this.flushProperties=function(){r=new Properties},this.trim=function(){i.trim()},this.appendElemIfNotEmpty=function(t){i.appendElemIfNotEmpty(t)},this.clone=function(){var t,e,n,r=window[this.getName()];t="function"==typeof r?new r:new Tag;for(e in this)this.hasOwnProperty(e)&&(n=this[e],t[e]=n&&"function"==typeof n.clone?n.clone():n);return t},this.loadFromElement=function(t){var e,n,r,o,s,h,a=!1,l=!1,p=[];if(t instanceof Element){for(n=t.childNodes,h=n.length,this.setTag(t.tagName.toLowerCase()),o=t.attributes,o&&(e=this.getProperties(),a=e.load(o),this.setProperties(e)),s=0;h>s;s++)r=n.item(s),p.push(r);l=i.load(p)}return a&&l},this.loadIntoElement=function(t){var e,n,r=this.getProperties().getCore();for(e in r)if(r.hasOwnProperty(e)){n=r[e],n&&"function"==typeof n.toString&&(n=n.toString());try{t.setAttribute(e,n)}catch(i){console.log(i.name+" occurred when loading properties on the element: "+i.message)}}},this.extractFromTemplate=function(t,e){var n={};return e.forEach(function(e){t.hasOwnProperty(e)&&(n[e]=t[e])}),n},this.toNode=function(){var t=document.createElement(this.getTag());return this.getProperties().decorateElement(t),this.getContent().stickTo(t),t},this.setTitle=function(t){"string"==typeof t&&t.length>0?this.setProperty("title",t):this.dropProperty("title")},this.applyToAll=function(t){i&&"function"==typeof t&&i.applyToAll(t)},this.mark=function(t){this.setMarker(t),this.setProperty(t,this.getName())},this.unmark=function(){var t=this.getMarker();t&&(this.dropProperty(t),o=null)},this.shrinkBy=function(t){r.shrinkBy(t)},this.setStylePropertyToAll=function(t,e){var n,r,i=new Content,o=this.length();for(n=0;o>n;n++)r=this.getElem(n),r.setStyleProperty(t,e),i.appendElem(r);this.setContent(i)},this.setStylePropertyOfRange=function(t,e,n){if(!Array.isArray(n)&&null!==n&&void 0!==n)throw new Error("Range must be an array!");var r,i,o=new Content,s=this.length(),h=null===n||void 0===n;for(r=0;s>r;r++)i=this.getElem(r),(h||-1!==n.indexOf(r))&&i.setStyleProperty(t,e),o.appendElem(i);this.setContent(o)},this.getStylePropertyOfRange=function(t,e){if(!Array.isArray(e)&&null!==e&&void 0!==e)throw new Error("Range must be an array!");if(Array.isArray(e)&&0===e.length)return null;var n=this.length();if(null===e||void 0===e){e=[];var r;for(r=0;n>r;r++)e.push(r);return this.getStylePropertyOfRange(t,e)}var i,o;return e=e.map(function(t){return 0>t?n+t:t}),e.forEach(function(e){try{o=this.getElem(e).getStyleProperty(t)}catch(n){console.log("Error ("+n.message+") when retrieving style property "+t+" of element n. "+e),o=null}if(void 0===i)i=o;else if(i!==o)return null}.bind(this)),i},this.template=function(){var t={},e=this.getTag(),n=this.getContent(),r=this.getProperties();if(e&&(t.tag=e),r){var i=r.template();"object"==typeof i&&0!==Object.keys(i).length&&(t.root=i)}if(n){var o=n.template();Array.isArray(o)&&o.length>0&&(t.children=o)}return t},this.loadTemplate=function(t){this.loadProperTemplate(t),this.loadChildTemplates(this.extractChildTemplates(t))},this.loadProperTemplate=function(t){var e=this.getProperties();e.appendProperty(this.extractProperTemplate(t)),this.setProperties(e)},this.loadChildTemplates=function(t){var e=this.getContent();e&&(e.loadTemplateBunch(t),this.setContent(e))},this.extractProperTemplate=function(t){return t.root||{}},this.extractChildTemplates=function(t){return t.children||[]}}Tag.prototype.characteristicFunction=function(t){return t instanceof Node};
function UList(){"use strict";return this instanceof UList?(List.call(this),this.setTag("ul"),void this.setName("UList")):new UList}UList.prototype=Object.create(List.prototype),UList.prototype.characteristicFunction=function(t){return t instanceof Element&&"ul"===t.tagName.toLowerCase()};
function Unit(e,t){"use strict";var r,n;if(!(this instanceof Unit))return new Unit(e,t);var i,s;!function(e,t){if(e instanceof Unit)return s=e.getMeasure(),void(i=e.getValue());if(e||(i=0),"string"!=typeof t&&void 0!==t)throw new Error("The unit of measurement must be a string!");switch(t&&""!==t.trim()&&(s=t.trim()),typeof e){case"number":i=e;break;case"string":if(r=""===e?0:parseFloat(e),isNaN(r))throw new Error("Can not convert "+e+" into a Unit object!");n=e.replace(r.toString(),"").trim(),i=r,void 0===s&&""!==n&&(s=n)}}(e,t),this.getValue=function(){return i},this.getValueAsString=function(){var e=this.getValue();return void 0!==e?e.toString():""},this.setValue=function(e){if("number"!=typeof e)throw new Error("Value attribute of Unit instance must be a number!");i=e},this.getMeasure=function(){return s},this.setMeasure=function(e){if("string"!=typeof e||""===e.trim())throw new Error("Measure attribute of Unit instance must be a non-empty string!");s=e},this.clone=function(){return new Unit(this.getValue(),this.getMeasure())},this.isLikeAs=function(e){if(!(e instanceof Unit))try{e=new Unit(e)}catch(t){return!1}return this.getMeasure()===e.getMeasure()},this.isZero=function(){return 0===this.getValue()},this.add=function(e){if(!(e instanceof Unit))return this.add(new Unit(e));if(this.isLikeAs(e))return new Unit(this.getValue()+e.getValue(),this.getMeasure());if(this.isZero())return e.isZero()?new Unit(0):new Unit(e.getValue(),e.getMeasure());if(e.isZero())return new Unit(this.getValue(),this.getMeasure());throw new Error("These Unit instances can not be summed up!")},this.sub=function(e){var t=e instanceof Unit?e:new Unit(e),r=new Unit(-t.getValue(),t.getMeasure());return this.add(r)},this.times=function(e){if(void 0===e)throw new Error("Argument is missing!");if("number"!=typeof e)throw new Error("Argument must be a number!");return new Unit(e*this.getValue(),this.getMeasure())},this.toString=function(e){var t="",r=this.getValue();if("number"!=typeof r)return t;t+=r.toString();var n=this.getMeasure();return"string"==typeof n&&n.length>0&&(t+=(e||"")+n),t};var u=function(e,t,r){if("number"!=typeof e||"number"!=typeof t||0===t)throw new Error("Numerator must be a number, denumerator must be a non-zero number.");var n=e/t;if(void 0===r)return n;if(!this.isInteger(r)||0>r)throw new Error("Precision must be non-negative integer.");var i=Math.pow(10,r),s=parseInt(n*i,10)/i;return s}.bind(this);this.frac=function(e,t){if(void 0===e)throw new Error("Can not divide by nothing!");var r;try{r=e instanceof Unit?e:new Unit(e)}catch(n){throw new Error("Encountered error when converting argument into Unit instance: "+n)}var i=new Unit,s=r.getValue();if(0===s)throw new Error("Can not divide by zero!");if(!r.hasMeasure()&&this.hasMeasure())i.setMeasure(this.getMeasure());else if(this.getMeasure()!==r.getMeasure())throw new Error("Can not divide these objects!");return i.setValue(u(this.getValue(),s,t)),i},this.hasMeasure=function(){var e=this.getMeasure();return"string"==typeof e&&e.length>0},this.toPercent=function(){if(this.hasMeasure())throw new Error("Only dimensionless numbers can be representred as percents!");var e,t=this.getValue();if(this.isInteger(t))e=100*t;else{var r=t.toString()+"00",n=r.split(".");e=n[0]+n[1].substr(0,2)+"."+n[1].substr(2),e=parseFloat(e,10)}return new Unit(e,"%")},this.fromPercent=function(){if("%"!==this.getMeasure())throw new Error("The target must be in percentage form!");return new Unit(this.getValue()/100)},this.suggestMeasure=function(e){if(!this.hasMeasure())try{this.setMeasure(e)}catch(t){console.log("Suggested measure was not set. Reason: "+t.toString())}},this.floor=function(){return new Unit(Math.floor(this.getValue()),this.getMeasure())},this.isInteger=function(e){return parseInt(e,10)===e}}