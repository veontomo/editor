function CDownload(){"use strict";if(!(this instanceof CDownload))return new CDownload;Controller.call(this);var e="php/saveDraft.php",t="php/downloadFile.php";this.downloadAsHtml=function(e,t){try{var o,n,a,s=e.getValueOf("tab-general","filename"),i=e.getValueOf("tab-general","mode"),l=t.document.getBody().$;a=Helper.cssOfSelector("body",NEWSLETTER.cssBase),n=new Document(l),n.setWrapCss(a),n.clean([/\bclass/,/\bid/,NEWSLETTER["marker-name"],/\bdata-.*/]),n.convertTo(i),o=n.docHtml(),this.downloadFile(o,s)}catch(r){this.showMessage(r.name+": "+r.message)}},this.downloadRaw=function(e,t){try{var o=t.getSnapshot(),n=e.getValueOf("basic","filename");this.downloadFile(o,n)}catch(a){this.showMessage(a.name+": "+a.message)}},this.appendTimeStamp=function(e){e="string"==typeof e?e:"";var t=new Date,o=e+[t.getFullYear(),("0"+(t.getMonth()+1)).slice(-2),("0"+t.getDate()).slice(-2),("0"+t.getHours()).slice(-2),("0"+t.getMinutes()).slice(-2),("0"+t.getSeconds()).slice(-2)].join("-")+".html";return o},this.downloadFile=function(o,n){return"string"!=typeof o?void this.showMessage("Can not download non-string content!"):void $.post(e,{data:o,filename:n},function(e){$(location).attr("href",t+"?filename="+e)})},this.file}CDownload.prototype=Object.create(Controller.prototype);